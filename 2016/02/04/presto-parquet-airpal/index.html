<!doctype html>



  


<html class="theme-next pisces use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"/>




  <link href="//fonts.googleapis.com/css?family=Lato:300,400,700,400italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">



<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=0.5.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="parquet,presto," />





  <link rel="alternate" href="/atom.xml" title="东杰书屋" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=0.5.0" />






<meta name="description" content="I came across a blog post from Brandon Harris recently where he discussed a credit card fraud detection project he’d been working on with a team at the University of Chicago. In the post he described">
<meta property="og:type" content="article">
<meta property="og:title" content="Presto, Parquet & Airpal">
<meta property="og:url" content="http://blog.djstudy.net/2016/02/04/presto-parquet-airpal/index.html">
<meta property="og:site_name" content="东杰书屋">
<meta property="og:description" content="I came across a blog post from Brandon Harris recently where he discussed a credit card fraud detection project he’d been working on with a team at the University of Chicago. In the post he described">
<meta property="og:updated_time" content="2016-02-04T11:43:10.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Presto, Parquet & Airpal">
<meta name="twitter:description" content="I came across a blog post from Brandon Harris recently where he discussed a credit card fraud detection project he’d been working on with a team at the University of Chicago. In the post he described">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 6242999463699285000,
      author: 'hivefans'
    }
  };
</script>

  <title> Presto, Parquet & Airpal | 东杰书屋 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  



  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?05207dc6d0c785fb39a80bb5af7c3d8a";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>






  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">东杰书屋</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">环境不会改变，解决之道在于改变自己。</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu ">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-home fa-fw"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-th fa-fw"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-user fa-fw"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-archive fa-fw"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-tags fa-fw"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-commonweal">
          <a href="/404.html" rel="section">
            
              <i class="menu-item-icon fa fa-heartbeat fa-fw"></i> <br />
            
            公益404
          </a>
        </li>
      

      
      
      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                Presto, Parquet & Airpal
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-02-04T19:43:10+08:00" content="2016-02-04">
              2016-02-04
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/big-data/" itemprop="url" rel="index">
                    <span itemprop="name">big data</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/02/04/presto-parquet-airpal/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/02/04/presto-parquet-airpal/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          
          
          <span>&nbsp; | &nbsp;
          <span id="busuanzi_value_page_pv" ></span>次阅读
          </span>    
          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>I came across a <a href="http://brandonharris.io/evaluating-big-data-performance-of-prestodb-and-parquet-on-s3-storage/" target="_blank" rel="external">blog post</a> from Brandon Harris recently where he discussed a credit card fraud detection project he’d been working on with a team at the University of Chicago. In the post he described how Presto and Parquet-formatted files had gone a long way to speeding up ad-hoc queries against a ~250GB dataset he’s working with.</p>
<p>Presto was born at Facebook and was <a href="https://github.com/facebook/presto" target="_blank" rel="external">open sourced</a> within a year of it’s inception. It’s a distributed query engine capable of running interactive queries against big data sources. There’s support for data sources such as Hive, Kafka, PostgreSQL, Redis and Cassandra <a href="https://prestodb.io/docs/current/connector.html" target="_blank" rel="external">among many others</a>. Netflix has blogged about their positive experiences with Presto on a <a href="http://techblog.netflix.com/2014/10/using-presto-in-our-big-data-platform.html" target="_blank" rel="external">10PB Data Warehouse</a> they’ve got that’s happily handling 2,500 ad-hoc queries a day.</p>
<p>In Brandon’s blog post there is a chart showing a query that’s executed in Hive against data stored in CSV format taking 130 seconds and then the same query run via Presto against data stored in Parquet format taking less than 5 seconds. I trust the measurements of his queries are accurate but what I’m interested in is what is involved in getting an environment up to run these sorts of queries.</p>
<p>As of this writing Bigtop’s <a href="https://issues.apache.org/jira/browse/BIGTOP-1561" target="_blank" rel="external">Presto support isn’t ready</a> (though <a href="https://github.com/apache/bigtop/pull/32/files" target="_blank" rel="external">pull requests</a> are being worked on) so to get an environment up and running locally I’ll have to perform some of the installation steps manually.</p>
<h2 id="Launching_a_Hadoop_Cluster_in_Docker_Containers"><a href="#Launching_a_Hadoop_Cluster_in_Docker_Containers" class="headerlink" title="Launching a Hadoop Cluster in Docker Containers"></a>Launching a Hadoop Cluster in Docker Containers</h2><p>This process begins with a fresh Ubuntu 15 installation acting as the host for Docker containers that a Hadoop cluster will live within. I discuss getting Ubuntu 15 ready to run Docker in my <a href="http://tech.marksblogg.com/hadoop-up-and-running.html#bigtop-run-a-dockerized-hadoop-cluster" target="_blank" rel="external">Hadoop Up and Running</a> blog post.</p>
<p>With Docker ready I’ll checkout the Bigtop git repository and launch Ubuntu 14.04-based containers (as of this writing this is the latest <a href="https://hub.docker.com/r/bigtop/deploy/tags/" target="_blank" rel="external">supported version</a> of Ubuntu on Intel-based systems).<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">clone</span> https://github.com/apache/bigtop.git</span><br><span class="line">$ <span class="built_in">cd</span> bigtop/bigtop-deploy/vm/vagrant-puppet-docker/</span><br><span class="line">$ sudo docker pull bigtop/deploy:ubuntu-<span class="number">14.04</span></span><br><span class="line">$ vi vagrantconfig.yaml</span><br></pre></td></tr></table></figure></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">docker:</span><br><span class="line">        memory_size: <span class="string">"4096"</span></span><br><span class="line">        image:  <span class="string">"bigtop/deploy:ubuntu-14.04"</span></span><br><span class="line"></span><br><span class="line">boot2docker:</span><br><span class="line">        memory_size: <span class="string">"4096"</span></span><br><span class="line">        number_cpus: <span class="string">"1"</span></span><br><span class="line"></span><br><span class="line">repo: <span class="string">"http://bigtop-repos.s3.amazonaws.com/releases/1.0.0/ubuntu/trusty/x86_64"</span></span><br><span class="line">distro: debian</span><br><span class="line">components: [hadoop, yarn, hive]</span><br><span class="line">namenode_ui_port: <span class="string">"50070"</span></span><br><span class="line">yarn_ui_port: <span class="string">"8088"</span></span><br><span class="line">hbase_ui_port: <span class="string">"60010"</span></span><br><span class="line"><span class="built_in">enable</span>_<span class="built_in">local</span>_repo: <span class="literal">false</span></span><br><span class="line">smoke_<span class="built_in">test</span>_components: [mapreduce, pig]</span><br><span class="line">jdk: <span class="string">"openjdk-7-jdk"</span></span><br></pre></td></tr></table></figure>
<p>While I was writing this blog post Bigtop 1.1 was <a href="https://github.com/apache/bigtop/commit/dbf098fe56246cf44ca8d9c2940f2c5c59df40de" target="_blank" rel="external">being cut</a> and the resources from their 1.1.0 endpoint were returning HTTP 403 messages so I’ve stuck with the 1.0.0 endpoints for now.<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo ./docker-hadoop.sh --create <span class="number">3</span></span><br><span class="line">$ sudo vagrant ssh bigtop1</span><br></pre></td></tr></table></figure></p>
<h2 id="Getting_Hive_u2019s_Metastore_Up_and_Running"><a href="#Getting_Hive_u2019s_Metastore_Up_and_Running" class="headerlink" title="Getting Hive’s Metastore Up and Running"></a>Getting Hive’s Metastore Up and Running</h2><p>By default the Derby embedded database driver is enabled in the boilerplate Hive configurations provided by Bigtop. This driver can only allow one process at a time to connect to it. If you use it Hive’s Metastore server won’t communicate properly with Presto and you’ll get “does not exist” messages every time you try to access a table.<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> track_metadata_csv;</span></span><br><span class="line">... Table hive.default.track_metadata_csv does not exist</span><br></pre></td></tr></table></figure></p>
<p>For this reason I’ve installed MySQL and used it as the data backend for Hive’s Metastore.<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ apt-get install \</span><br><span class="line">    libmysql-java \</span><br><span class="line">    mysql-server</span><br><span class="line">$ ln <span class="operator">-s</span> /usr/share/java/mysql-connector-java.jar \</span><br><span class="line">        /usr/lib/hive/lib/mysql-connector-java.jar</span><br><span class="line">$ /etc/init.d/mysql start</span><br><span class="line">$ mysql -uroot -proot <span class="operator">-e</span><span class="string">'CREATE DATABASE hcatalog;'</span></span><br></pre></td></tr></table></figure></p>
<p>When you install MySQL you’ll be prompted to set a root login and password. I’ve set both values to root in this example. Below is the Hive site configuration file.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ vi /etc/hive/conf/hive-site.xml</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="pi">&lt;?xml version="1.0"?&gt;</span></span><br><span class="line"><span class="pi">&lt;?xml-stylesheet type="text/xsl" href="configuration.xsl"?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="title">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">name</span>&gt;</span>hbase.zookeeper.quorum<span class="tag">&lt;/<span class="title">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">value</span>&gt;</span>bigtop1.docker<span class="tag">&lt;/<span class="title">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="title">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="title">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">name</span>&gt;</span>hive.execution.engine<span class="tag">&lt;/<span class="title">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">value</span>&gt;</span>mr<span class="tag">&lt;/<span class="title">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="title">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="title">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">name</span>&gt;</span>javax.jdo.option.ConnectionURL<span class="tag">&lt;/<span class="title">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">value</span>&gt;</span>jdbc:mysql://localhost/hcatalog?createDatabaseIfNotExist=true<span class="tag">&lt;/<span class="title">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="title">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="title">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">name</span>&gt;</span>javax.jdo.option.ConnectionUserName<span class="tag">&lt;/<span class="title">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">value</span>&gt;</span>root<span class="tag">&lt;/<span class="title">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="title">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="title">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">name</span>&gt;</span>javax.jdo.option.ConnectionPassword<span class="tag">&lt;/<span class="title">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">value</span>&gt;</span>root<span class="tag">&lt;/<span class="title">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="title">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="title">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">name</span>&gt;</span>javax.jdo.option.ConnectionDriverName<span class="tag">&lt;/<span class="title">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">value</span>&gt;</span>com.mysql.jdbc.Driver<span class="tag">&lt;/<span class="title">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="title">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="title">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">name</span>&gt;</span>hive.hwi.war.file<span class="tag">&lt;/<span class="title">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">value</span>&gt;</span>/usr/lib/hive/lib/hive-hwi.war<span class="tag">&lt;/<span class="title">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="title">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>I then launched Hive and made sure the Metastore’s database exists.<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hive</span><br></pre></td></tr></table></figure></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> <span class="keyword">IF</span> <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> metastore_db;</span></span><br></pre></td></tr></table></figure>
<p>After that I closed out of Hive and launched it’s Metastore service in the background. You’ll see it binded to port 9083 if it’s running.<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ hive --service metastore &amp;</span><br><span class="line">$ netstat -an | grep <span class="number">9083</span></span><br></pre></td></tr></table></figure></p>
<h2 id="Getting_some_data_to_play_with"><a href="#Getting_some_data_to_play_with" class="headerlink" title="Getting some data to play with"></a>Getting some data to play with</h2><p>I need some data to play with in this exercise so I dumped the Million Song Dataset to CSV and imported it into HDFS</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ apt-get install sqlite3</span><br><span class="line">$ wget -c http://labrosa.ee.columbia.edu/millionsong/sites/default/files/AdditionalFiles/track_metadata.db</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ sqlite3 track_metadata.db &lt;&lt;!</span><br><span class="line">.headers off</span><br><span class="line">.mode csv</span><br><span class="line">.output track_metadata.csv</span><br><span class="line">SELECT track_id,</span><br><span class="line">     artist_id,</span><br><span class="line">     artist_familiarity,</span><br><span class="line">     artist_hotttnesss,</span><br><span class="line">     duration,</span><br><span class="line">     year</span><br><span class="line">FROM songs;</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ hadoop fs -put \</span><br><span class="line">    track_metadata.csv \</span><br><span class="line">    /tmp/track_metadata.csv</span><br></pre></td></tr></table></figure>
<p>With the CSV file sitting in HDFS I’ll create a Hive table for it. Once that table is created I can create a second, Parquet-formatted table and import the data from the first table into the second.<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hive</span><br></pre></td></tr></table></figure></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> track_metadata_csv (</span><br><span class="line">    track_id            <span class="built_in">VARCHAR</span>(<span class="number">18</span>),</span><br><span class="line">    artist_id           <span class="built_in">VARCHAR</span>(<span class="number">18</span>),</span><br><span class="line">    artist_familiarity  <span class="built_in">DECIMAL</span>(<span class="number">16</span>, <span class="number">15</span>),</span><br><span class="line">    artist_hotttnesss   <span class="built_in">DECIMAL</span>(<span class="number">16</span>, <span class="number">15</span>),</span><br><span class="line">    <span class="keyword">duration</span>            <span class="built_in">DECIMAL</span>(<span class="number">12</span>, <span class="number">8</span>),</span><br><span class="line">    <span class="keyword">year</span>                <span class="built_in">SMALLINT</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">ROW</span> <span class="keyword">FORMAT</span> <span class="keyword">DELIMITED</span> <span class="keyword">FIELDS</span> <span class="keyword">TERMINATED</span> <span class="keyword">BY</span> <span class="string">','</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="operator"><span class="keyword">LOAD</span> <span class="keyword">DATA</span> INPATH <span class="string">'/tmp/track_metadata.csv'</span></span><br><span class="line"><span class="keyword">INTO</span> <span class="keyword">TABLE</span> track_metadata_csv;</span></span><br><span class="line"></span><br><span class="line"><span class="operator"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> track_metadata_parquet (</span><br><span class="line">    track_id            <span class="built_in">VARCHAR</span>(<span class="number">18</span>),</span><br><span class="line">    artist_id           <span class="built_in">VARCHAR</span>(<span class="number">18</span>),</span><br><span class="line">    artist_familiarity  <span class="built_in">DECIMAL</span>(<span class="number">16</span>, <span class="number">15</span>),</span><br><span class="line">    artist_hotttnesss   <span class="built_in">DECIMAL</span>(<span class="number">16</span>, <span class="number">15</span>),</span><br><span class="line">    <span class="keyword">duration</span>            <span class="built_in">DECIMAL</span>(<span class="number">12</span>, <span class="number">8</span>),</span><br><span class="line">    <span class="keyword">year</span>                <span class="built_in">SMALLINT</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">STORED</span> <span class="keyword">AS</span> parquet;</span></span><br><span class="line"></span><br><span class="line"><span class="operator"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="keyword">TABLE</span> track_metadata_parquet</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> track_metadata_csv;</span></span><br></pre></td></tr></table></figure>
<p>I now have that table’s metadata stored in Hive’s Metastore and a Parquet-formatted file of that data sitting on HDFS:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ hadoop fs -ls \</span><br><span class="line">    /user/hive/warehouse/track_metadata_parquet</span><br><span class="line">Found <span class="number">1</span> items</span><br><span class="line">-rw-r--r--   <span class="number">3</span> root hadoop   <span class="number">45849172</span> <span class="number">2016</span>-<span class="number">01</span>-<span class="number">31</span> <span class="number">13</span>:<span class="number">31</span> /user/hive/warehouse/track_metadata_parquet/<span class="number">000000</span>_0</span><br><span class="line">$ mysqldump \</span><br><span class="line">    -uroot \</span><br><span class="line">    -proot \</span><br><span class="line">    --no-create-info \</span><br><span class="line">    --skip-add-locks \</span><br><span class="line">    --skip-disable-keys \</span><br><span class="line">    --skip-comments \</span><br><span class="line">    hcatalog | \</span><br><span class="line">    grep ^INSERT | \</span><br><span class="line">    sort</span><br></pre></td></tr></table></figure></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`CDS`</span> <span class="keyword">VALUES</span> (<span class="number">1</span>),(<span class="number">2</span>);</span></span><br><span class="line"><span class="operator"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`COLUMNS_V2`</span> <span class="keyword">VALUES</span></span><br><span class="line">    (<span class="number">1</span>,<span class="literal">NULL</span>,<span class="string">'artist_familiarity'</span>,<span class="string">'decimal(16,15)'</span>,<span class="number">2</span>),</span><br><span class="line">    (<span class="number">1</span>,<span class="literal">NULL</span>,<span class="string">'artist_hotttnesss'</span>,<span class="string">'decimal(16,15)'</span>,<span class="number">3</span>),</span><br><span class="line">    (<span class="number">1</span>,<span class="literal">NULL</span>,<span class="string">'artist_id'</span>,<span class="string">'varchar(18)'</span>,<span class="number">1</span>),</span><br><span class="line">    (<span class="number">1</span>,<span class="literal">NULL</span>,<span class="string">'duration'</span>,<span class="string">'decimal(12,8)'</span>,<span class="number">4</span>),</span><br><span class="line">    (<span class="number">1</span>,<span class="literal">NULL</span>,<span class="string">'track_id'</span>,<span class="string">'varchar(18)'</span>,<span class="number">0</span>),</span><br><span class="line">    (<span class="number">1</span>,<span class="literal">NULL</span>,<span class="string">'year'</span>,<span class="string">'smallint'</span>,<span class="number">5</span>),</span><br><span class="line">    (<span class="number">2</span>,<span class="literal">NULL</span>,<span class="string">'artist_familiarity'</span>,<span class="string">'decimal(16,15)'</span>,<span class="number">2</span>),</span><br><span class="line">    (<span class="number">2</span>,<span class="literal">NULL</span>,<span class="string">'artist_hotttnesss'</span>,<span class="string">'decimal(16,15)'</span>,<span class="number">3</span>),</span><br><span class="line">    (<span class="number">2</span>,<span class="literal">NULL</span>,<span class="string">'artist_id'</span>,<span class="string">'varchar(18)'</span>,<span class="number">1</span>),</span><br><span class="line">    (<span class="number">2</span>,<span class="literal">NULL</span>,<span class="string">'duration'</span>,<span class="string">'decimal(12,8)'</span>,<span class="number">4</span>),</span><br><span class="line">    (<span class="number">2</span>,<span class="literal">NULL</span>,<span class="string">'track_id'</span>,<span class="string">'varchar(18)'</span>,<span class="number">0</span>),</span><br><span class="line">    (<span class="number">2</span>,<span class="literal">NULL</span>,<span class="string">'year'</span>,<span class="string">'smallint'</span>,<span class="number">5</span>);</span></span><br><span class="line"><span class="operator"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`DBS`</span> <span class="keyword">VALUES</span></span><br><span class="line">    (<span class="number">1</span>,<span class="string">'Default Hive database'</span>,<span class="string">'hdfs://bigtop1.docker:8020/user/hive/warehouse'</span>,<span class="string">'default'</span>,<span class="string">'public'</span>,<span class="string">'ROLE'</span>),</span><br><span class="line">    (<span class="number">2</span>,<span class="literal">NULL</span>,<span class="string">'hdfs://bigtop1.docker:8020/user/hive/warehouse/metastore_db.db'</span>,<span class="string">'metastore_db'</span>,<span class="string">'root'</span>,<span class="string">'USER'</span>);</span></span><br><span class="line"><span class="operator"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`GLOBAL_PRIVS`</span> <span class="keyword">VALUES</span> (<span class="number">1</span>,<span class="number">1454255378</span>,<span class="number">1</span>,<span class="string">'admin'</span>,<span class="string">'ROLE'</span>,<span class="string">'admin'</span>,<span class="string">'ROLE'</span>,<span class="string">'All'</span>);</span></span><br><span class="line"><span class="operator"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`ROLES`</span> <span class="keyword">VALUES</span></span><br><span class="line">    (<span class="number">1</span>,<span class="number">1454255378</span>,<span class="string">'admin'</span>,<span class="string">'admin'</span>),</span><br><span class="line">    (<span class="number">2</span>,<span class="number">1454255378</span>,<span class="string">'public'</span>,<span class="string">'public'</span>);</span></span><br><span class="line"><span class="operator"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`SDS`</span> <span class="keyword">VALUES</span></span><br><span class="line">    (<span class="number">1</span>,<span class="number">1</span>,<span class="string">'org.apache.hadoop.mapred.TextInputFormat'</span>,<span class="string">'\0'</span>,<span class="string">'\0'</span>,<span class="string">'hdfs://bigtop1.docker:8020/user/hive/warehouse/track_metadata_csv'</span>,-<span class="number">1</span>,<span class="string">'org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat'</span>,<span class="number">1</span>),</span><br><span class="line">    (<span class="number">2</span>,<span class="number">2</span>,<span class="string">'org.apache.hadoop.hive.ql.io.parquet.MapredParquetInputFormat'</span>,<span class="string">'\0'</span>,<span class="string">'\0'</span>,<span class="string">'hdfs://bigtop1.docker:8020/user/hive/warehouse/track_metadata_parquet'</span>,-<span class="number">1</span>,<span class="string">'org.apache.hadoop.hive.ql.io.parquet.MapredParquetOutputFormat'</span>,<span class="number">2</span>);</span></span><br><span class="line"><span class="operator"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`SEQUENCE_TABLE`</span> <span class="keyword">VALUES</span></span><br><span class="line">    (<span class="string">'org.apache.hadoop.hive.metastore.model.MColumnDescriptor'</span>,<span class="number">6</span>),</span><br><span class="line">    (<span class="string">'org.apache.hadoop.hive.metastore.model.MDatabase'</span>,<span class="number">6</span>),</span><br><span class="line">    (<span class="string">'org.apache.hadoop.hive.metastore.model.MGlobalPrivilege'</span>,<span class="number">6</span>),</span><br><span class="line">    (<span class="string">'org.apache.hadoop.hive.metastore.model.MRole'</span>,<span class="number">6</span>),</span><br><span class="line">    (<span class="string">'org.apache.hadoop.hive.metastore.model.MSerDeInfo'</span>,<span class="number">6</span>),</span><br><span class="line">    (<span class="string">'org.apache.hadoop.hive.metastore.model.MStorageDescriptor'</span>,<span class="number">6</span>),</span><br><span class="line">    (<span class="string">'org.apache.hadoop.hive.metastore.model.MTable'</span>,<span class="number">6</span>),</span><br><span class="line">    (<span class="string">'org.apache.hadoop.hive.metastore.model.MVersionTable'</span>,<span class="number">6</span>);</span></span><br><span class="line"><span class="operator"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`SERDES`</span> <span class="keyword">VALUES</span></span><br><span class="line">    (<span class="number">1</span>,<span class="literal">NULL</span>,<span class="string">'org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe'</span>),</span><br><span class="line">    (<span class="number">2</span>,<span class="literal">NULL</span>,<span class="string">'org.apache.hadoop.hive.ql.io.parquet.serde.ParquetHiveSerDe'</span>);</span></span><br><span class="line"><span class="operator"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`SERDE_PARAMS`</span> <span class="keyword">VALUES</span></span><br><span class="line">    (<span class="number">1</span>,<span class="string">'field.delim'</span>,<span class="string">','</span>),</span><br><span class="line">    (<span class="number">1</span>,<span class="string">'serialization.format'</span>,<span class="string">','</span>),</span><br><span class="line">    (<span class="number">2</span>,<span class="string">'serialization.format'</span>,<span class="string">'1'</span>);</span></span><br><span class="line"><span class="operator"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`TABLE_PARAMS`</span> <span class="keyword">VALUES</span></span><br><span class="line">    (<span class="number">1</span>,<span class="string">'COLUMN_STATS_ACCURATE'</span>,<span class="string">'true'</span>),</span><br><span class="line">    (<span class="number">1</span>,<span class="string">'numFiles'</span>,<span class="string">'2'</span>),</span><br><span class="line">    (<span class="number">1</span>,<span class="string">'numRows'</span>,<span class="string">'0'</span>),</span><br><span class="line">    (<span class="number">1</span>,<span class="string">'rawDataSize'</span>,<span class="string">'0'</span>),</span><br><span class="line">    (<span class="number">1</span>,<span class="string">'totalSize'</span>,<span class="string">'161179824'</span>),</span><br><span class="line">    (<span class="number">1</span>,<span class="string">'transient_lastDdlTime'</span>,<span class="string">'1454255466'</span>),</span><br><span class="line">    (<span class="number">2</span>,<span class="string">'COLUMN_STATS_ACCURATE'</span>,<span class="string">'true'</span>),</span><br><span class="line">    (<span class="number">2</span>,<span class="string">'numFiles'</span>,<span class="string">'2'</span>),</span><br><span class="line">    (<span class="number">2</span>,<span class="string">'numRows'</span>,<span class="string">'2000000'</span>),</span><br><span class="line">    (<span class="number">2</span>,<span class="string">'rawDataSize'</span>,<span class="string">'12000000'</span>),</span><br><span class="line">    (<span class="number">2</span>,<span class="string">'totalSize'</span>,<span class="string">'136579903'</span>),</span><br><span class="line">    (<span class="number">2</span>,<span class="string">'transient_lastDdlTime'</span>,<span class="string">'1454255498'</span>);</span></span><br><span class="line"><span class="operator"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`TBLS`</span> <span class="keyword">VALUES</span></span><br><span class="line">    (<span class="number">1</span>,<span class="number">1454255462</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="string">'root'</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="string">'track_metadata_csv'</span>,<span class="string">'MANAGED_TABLE'</span>,<span class="literal">NULL</span>,<span class="literal">NULL</span>),</span><br><span class="line">    (<span class="number">2</span>,<span class="number">1454255471</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="string">'root'</span>,<span class="number">0</span>,<span class="number">2</span>,<span class="string">'track_metadata_parquet'</span>,<span class="string">'MANAGED_TABLE'</span>,<span class="literal">NULL</span>,<span class="literal">NULL</span>);</span></span><br><span class="line"><span class="operator"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`VERSION`</span> <span class="keyword">VALUES</span> (<span class="number">1</span>,<span class="string">'0.14.0'</span>,<span class="string">'Set by MetaStore'</span>);</span></span><br></pre></td></tr></table></figure>
<h2 id="Presto_Up_and_Running"><a href="#Presto_Up_and_Running" class="headerlink" title="Presto Up and Running"></a>Presto Up and Running</h2><p>Presto requires Java 8 so I’ll install that first.<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ add-apt-repository ppa:webupd8team/java</span><br><span class="line">$ apt-get update</span><br><span class="line">$ apt-get install oracle-java8-installer</span><br></pre></td></tr></table></figure></p>
<p>I have yet to see recent Debian packages for Presto so I’ll download the binaries instead.<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> ~</span><br><span class="line">$ wget -c https://repo1.maven.org/maven2/com/facebook/presto/presto-server/<span class="number">0.133</span>/presto-server-<span class="number">0.133</span>.tar.gz</span><br><span class="line">$ tar xzf presto-server-<span class="number">0.133</span>.tar.gz</span><br></pre></td></tr></table></figure></p>
<p>Presto requires a data folder for it to store locks, logs and a few other items and also requires a number of configuration files before it can begin to work properly.<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ mkdir -p /root/datap</span><br><span class="line">$ mkdir -p ~/presto-server-<span class="number">0.133</span>/etc/catalog</span><br><span class="line">$ <span class="built_in">cd</span> ~/presto-server-<span class="number">0.133</span>/etc</span><br></pre></td></tr></table></figure></p>
<p>Normally I wouldn’t suggest creating a data folder in the root partition but this work is all taking place in a Docker container that has exposed 13GB of space on the root partition.<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ df -H</span><br><span class="line">Filesystem      Size  Used Avail Use% Mounted on</span><br><span class="line">none             <span class="number">13</span>G  <span class="number">6.4</span>G  <span class="number">5.6</span>G  <span class="number">54</span>% /</span><br><span class="line">tmpfs           <span class="number">4.2</span>G  <span class="number">8.2</span>k  <span class="number">4.2</span>G   <span class="number">1</span>% /dev</span><br><span class="line">tmpfs           <span class="number">4.2</span>G     <span class="number">0</span>  <span class="number">4.2</span>G   <span class="number">0</span>% /sys/fs/cgroup</span><br><span class="line">/dev/sda1        <span class="number">13</span>G  <span class="number">6.4</span>G  <span class="number">5.6</span>G  <span class="number">54</span>% /vagrant</span><br><span class="line">shm              <span class="number">68</span>M     <span class="number">0</span>   <span class="number">68</span>M   <span class="number">0</span>% /dev/shm</span><br></pre></td></tr></table></figure></p>
<p>Next I need to create six configuration files. Below is an outline of where they live within the ~/presto-server-0.133/etc folder:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ tree ~/presto-server-<span class="number">0.133</span>/etc</span><br><span class="line">etc</span><br><span class="line">|-- catalog</span><br><span class="line">|   |-- hive.properties</span><br><span class="line">|   `-- jmx.properties</span><br><span class="line">|-- config.properties</span><br><span class="line">|-- jvm.config</span><br><span class="line">|-- log.properties</span><br><span class="line">`-- node.properties</span><br></pre></td></tr></table></figure></p>
<p>Here are the commands to set the contents on each of the configuration files.<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ vi ~/presto-server-<span class="number">0.133</span>/etc/config.properties</span><br></pre></td></tr></table></figure></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">coordinator=<span class="literal">true</span></span><br><span class="line">node-scheduler.include-coordinator=<span class="literal">true</span></span><br><span class="line">http-server.http.port=<span class="number">8080</span></span><br><span class="line">query.max-memory=<span class="number">800</span>MB</span><br><span class="line">query.max-memory-per-node=<span class="number">200</span>MB</span><br><span class="line">discovery-server.enabled=<span class="literal">true</span></span><br><span class="line">discovery.uri=http://<span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">8080</span></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ vi ~/presto-server-<span class="number">0.133</span>/etc/jvm.config</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">-server</span><br><span class="line">-Xmx800M</span><br><span class="line">-XX:+UseG1GC</span><br><span class="line">-XX:G1HeapRegionSize=<span class="number">32</span>M</span><br><span class="line">-XX:+UseGCOverheadLimit</span><br><span class="line">-XX:+ExplicitGCInvokesConcurrent</span><br><span class="line">-XX:+HeapDumpOnOutOfMemoryError</span><br><span class="line">-XX:OnOutOfMemoryError=<span class="built_in">kill</span> -<span class="number">9</span> %p</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ vi ~/presto-server-<span class="number">0.133</span>/etc/log.properties</span><br><span class="line">com.facebook.presto=INFO</span><br><span class="line">$ vi ~/presto-server-<span class="number">0.133</span>/etc/node.properties</span><br><span class="line">node.environment=dev</span><br><span class="line">node.id=ffffffff-ffff-ffff-ffff-ffffffffffff</span><br><span class="line">node.data-dir=/root/datap</span><br></pre></td></tr></table></figure>
<p>The JMX connector provides the ability to query Java Management Extensions (JMX) information from all nodes in a Presto cluster. Presto itself is heavily instrumented via JMX.<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ vi ~/presto-server-<span class="number">0.133</span>/etc/catalog/jmx.properties</span><br><span class="line">connector.name=jmx</span><br></pre></td></tr></table></figure></p>
<p>This file allows Presto to know where our Hive Metastore is and which connector to use to communicate with it.<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ vi ~/presto-server-<span class="number">0.133</span>/etc/catalog/hive.properties</span><br><span class="line">hive.metastore.uri=thrift://bigtop1.docker:<span class="number">9083</span></span><br><span class="line">connector.name=hive-hadoop2</span><br></pre></td></tr></table></figure></p>
<p>With those in place you can launch Presto’s server.<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ~/presto-server-<span class="number">0.133</span>/bin/launcher start</span><br></pre></td></tr></table></figure></p>
<p>It should expose a web frontend on port 8080 if it’s running properly.<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ curl localhost:<span class="number">8080</span></span><br></pre></td></tr></table></figure></p>
<h2 id="Presto_u2019s_CLI_Up_and_Running"><a href="#Presto_u2019s_CLI_Up_and_Running" class="headerlink" title="Presto’s CLI Up and Running"></a>Presto’s CLI Up and Running</h2><p>I’ll download the CLI JAR file for Presto, rename it to presto and then I can use it to connect to the Presto Server.<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> ~</span><br><span class="line">$ wget -c https://repo1.maven.org/maven2/com/facebook/presto/presto-cli/<span class="number">0.133</span>/presto-cli-<span class="number">0.133</span>-executable.jar</span><br><span class="line">$ mv presto-cli-<span class="number">0.133</span>-executable.jar presto</span><br><span class="line">$ chmod +x presto</span><br><span class="line">$ ./presto --server localhost:<span class="number">8080</span> --catalog hive --schema default</span><br></pre></td></tr></table></figure></p>
<p>I’ll then see if Presto can see the schemas in the Hive Metastore.</p>
<p>show schemas from hive;</p>
<pre><code>Schema
</code></pre><hr>
<p> default<br> information_schema<br> metastore_db<br>(3 rows)</p>
<h2 id="Executing_Queries_in_Presto"><a href="#Executing_Queries_in_Presto" class="headerlink" title="Executing Queries in Presto"></a>Executing Queries in Presto</h2><p>With the CLI communicating with the server properly I’ll run two queries. The first will count how many records per year exist in our million song database using the data in the CSV-backed table and the second will do the same against the Parquet-backed table.<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator"><span class="keyword">SELECT</span> <span class="keyword">year</span>, <span class="keyword">count</span>(*)</span><br><span class="line"><span class="keyword">FROM</span> track_metadata_csv</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> <span class="keyword">year</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">year</span>;</span></span><br><span class="line"> year | _col1</span><br><span class="line"><span class="comment">------+--------</span></span><br><span class="line">    0 | 968848</span><br><span class="line"> 1922 |     12</span><br><span class="line"> 1924 |     10</span><br><span class="line"> ...</span><br><span class="line"> 2008 |  69540</span><br><span class="line"> 2009 |  62102</span><br><span class="line"> 2010 |  18794</span><br><span class="line"> 2011 |      2</span><br><span class="line">(90 rows)</span><br><span class="line"></span><br><span class="line">Query 20160131_160009_00002_s4z65, FINISHED, 1 node</span><br><span class="line">Splits: 6 total, 6 done (100.00%)</span><br><span class="line">0:09 [2M rows, 154MB] [221K rows/s, 17MB/s]</span><br><span class="line"><span class="operator"><span class="keyword">SELECT</span> <span class="keyword">year</span>, <span class="keyword">count</span>(*)</span><br><span class="line"><span class="keyword">FROM</span> track_metadata_parquet</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> <span class="keyword">year</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">year</span>;</span></span><br><span class="line"> year | _col1</span><br><span class="line"><span class="comment">------+--------</span></span><br><span class="line">    0 | 968848</span><br><span class="line"> 1922 |     12</span><br><span class="line"> 1924 |     10</span><br><span class="line"> ...</span><br><span class="line"> 2008 |  69540</span><br><span class="line"> 2009 |  62102</span><br><span class="line"> 2010 |  18794</span><br><span class="line"> 2011 |      2</span><br><span class="line">(90 rows)</span><br><span class="line"></span><br><span class="line">Query 20160131_160411_00005_s4z65, FINISHED, 1 node</span><br><span class="line">Splits: 5 total, 5 done (100.00%)</span><br><span class="line">0:04 [3M rows, 87MB] [799K rows/s, 23.2MB/s]</span><br></pre></td></tr></table></figure></p>
<p>The query finished in 9 seconds with the CSV-formatted data and in 4 seconds with the Parquet-formatted data. I grepped the server log to see the time lines recorded by the Query Monitor.<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ grep <span class="number">20160131</span>_160009_00002_s4z65 ~/datap/var/<span class="built_in">log</span>/server.log</span><br><span class="line">...elapsed <span class="number">3886.00</span>ms :: planning <span class="number">644.26</span>ms :: scheduling <span class="number">1099.00</span>ms :: running <span class="number">2094.00</span>ms :: finishing <span class="number">49.00</span>ms...</span><br><span class="line"></span><br><span class="line">$ grep <span class="number">20160131</span>_160411_00005_s4z65 ~/datap/var/<span class="built_in">log</span>/server.log</span><br><span class="line">...elapsed <span class="number">1406.00</span>ms :: planning <span class="number">91.68</span>ms :: scheduling <span class="number">55.00</span>ms :: running <span class="number">1221.00</span>ms :: finishing <span class="number">38.00</span>ms...</span><br></pre></td></tr></table></figure></p>
<p>I’m not surprised that the columnar-based, Parquet-format-backed query was twice as fast but I’m not sure how the timings the Query Monitor recorded relate to the times reported by the CLI. It gives me something to dig into at a later point.</p>
<p>I took a look at the query plans to see if they offer anything of interest. In the case of these two queries they were identical bar the table names.<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN</span><br><span class="line">SELECT year, count(*)</span><br><span class="line">FROM track_metadata_csv</span><br><span class="line">GROUP BY year</span><br><span class="line">ORDER BY year;</span><br><span class="line">                                                                  </span><br><span class="line">----------------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line"> - Output[year, _col1] =&gt; [year:bigint, count:bigint]</span><br><span class="line">         _col1 := count</span><br><span class="line">     - Sort[year ASC_NULLS_LAST] =&gt; [year:bigint, count:bigint]</span><br><span class="line">         - Exchange[GATHER] =&gt; year:bigint, count:bigint</span><br><span class="line">             - Aggregate(FINAL)[year] =&gt; [year:bigint, count:bigint]</span><br><span class="line">                     count := "count"("count_9")</span><br><span class="line">                 - Exchange[REPARTITION] =&gt; year:bigint, count_9:bigint</span><br><span class="line">                     - Aggregate(PARTIAL)[year] =&gt; [year:bigint, count_9:bigint]</span><br><span class="line">                             count_9 := "count"(*)</span><br><span class="line">                         - TableScan[hive:hive:default:track_metadata_csv, originalConstraint = true] =&gt; [year:bigint]</span><br><span class="line">                                 LAYOUT: hive</span><br><span class="line">                                 year := HiveColumnHandle&#123;clientId=hive, name=year, hiveType=smallint, hiveColumnIndex=5, partitionKey=false&#125;</span><br><span class="line">EXPLAIN</span><br><span class="line">SELECT year, count(*)</span><br><span class="line">FROM track_metadata_parquet</span><br><span class="line">GROUP BY year</span><br><span class="line">ORDER BY year;</span><br><span class="line">                                                                  Query Plan</span><br><span class="line">----------------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line"> - Output[year, _col1] =&gt; [year:bigint, count:bigint]</span><br><span class="line">         _col1 := count</span><br><span class="line">     - Sort[year ASC_NULLS_LAST] =&gt; [year:bigint, count:bigint]</span><br><span class="line">         - Exchange[GATHER] =&gt; year:bigint, count:bigint</span><br><span class="line">             - Aggregate(FINAL)[year] =&gt; [year:bigint, count:bigint]</span><br><span class="line">                     count := "count"("count_9")</span><br><span class="line">                 - Exchange[REPARTITION] =&gt; year:bigint, count_9:bigint</span><br><span class="line">                     - Aggregate(PARTIAL)[year] =&gt; [year:bigint, count_9:bigint]</span><br><span class="line">                             count_9 := "count"(*)</span><br><span class="line">                         - TableScan[hive:hive:default:track_metadata_parquet, originalConstraint = true] =&gt; [year:bigint]</span><br><span class="line">                                 LAYOUT: hive</span><br><span class="line">                                 year := HiveColumnHandle&#123;clientId=hive, name=year, hiveType=smallint, hiveColumnIndex=5, partitionKey=false&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="Airpal_3A_A_Web_Interface_for_Presto"><a href="#Airpal_3A_A_Web_Interface_for_Presto" class="headerlink" title="Airpal: A Web Interface for Presto"></a>Airpal: A Web Interface for Presto</h2><p>In March 2015 AirBNB announced Airpal, a web-based query tool that works with Presto. Beyond a visual interface to run queries it offers access controls, metadata exploration, query progress tracking and CSV exporting of results.</p>
<p>These are the steps I took to install this software and launch it within the same Docker container as Presto.</p>
<p>The first thing I had to do was to get a copy of Airpal’s git repository and build the Airpal JAR file.<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ apt-get install \</span><br><span class="line">    build-essential \</span><br><span class="line">    git \</span><br><span class="line">    gradle \</span><br><span class="line">    mysql-server</span><br><span class="line">$ git <span class="built_in">clone</span> https://github.com/airbnb/airpal.git</span><br><span class="line">$ <span class="built_in">cd</span> airpal</span><br><span class="line">$ ./gradlew clean shadowJar</span><br></pre></td></tr></table></figure></p>
<p>I then created a MySQL database for Airpal to store it’s configuration and logs.<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ mysql \</span><br><span class="line">    -uroot \</span><br><span class="line">    -proot \</span><br><span class="line">    <span class="operator">-e</span><span class="string">'CREATE DATABASE `airpal` CHARACTER SET utf8 COLLATE utf8_general_ci;'</span></span><br></pre></td></tr></table></figure></p>
<p>Airpal needs a configuration file to tell it’s JAR file how to, among other things, connect with the MySQL data backend.<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ vi reference.yml</span><br></pre></td></tr></table></figure></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"># Logging settings</span><br><span class="line">logging:</span><br><span class="line"></span><br><span class="line">  loggers:</span><br><span class="line">    org.apache.shiro: INFO</span><br><span class="line"></span><br><span class="line">  # The default level of all loggers. Can be OFF, ERROR, WARN, INFO, DEBUG, TRACE, or ALL.</span><br><span class="line">  level: INFO</span><br><span class="line"></span><br><span class="line"># HTTP-specific options.</span><br><span class="line">server:</span><br><span class="line">  applicationConnectors:</span><br><span class="line">    - type: http</span><br><span class="line">      port: 8081</span><br><span class="line">      idleTimeout: 10 seconds</span><br><span class="line"></span><br><span class="line">  adminConnectors:</span><br><span class="line">    - type: http</span><br><span class="line">      port: 8082</span><br><span class="line"></span><br><span class="line">shiro:</span><br><span class="line">  iniConfigs: ["classpath:shiro_allow_all.ini"]</span><br><span class="line"></span><br><span class="line">dataSourceFactory:</span><br><span class="line">  driverClass: com.mysql.jdbc.Driver</span><br><span class="line">  user: root</span><br><span class="line">  password: root</span><br><span class="line">  url: jdbc:mysql://127.0.0.1:3306/airpal</span><br><span class="line"></span><br><span class="line"># The URL to the Presto coordinator.</span><br><span class="line">prestoCoordinator: http://127.0.0.1:8080</span><br></pre></td></tr></table></figure>
<p>With that in place I setup Airpal’s database schema and launched the server in the background.<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ java -Duser.timezone=UTC \</span><br><span class="line">       -cp build/libs/airpal-*-all.jar \</span><br><span class="line">       com.airbnb.airpal.AirpalApplication \</span><br><span class="line">       db migrate reference.yml</span><br><span class="line">$ java -server \</span><br><span class="line">       -Duser.timezone=UTC \</span><br><span class="line">       -cp build/libs/airpal-*-all.jar \</span><br><span class="line">       com.airbnb.airpal.AirpalApplication \</span><br><span class="line">       server reference.yml &amp;</span><br></pre></td></tr></table></figure></p>
<p>Their is a health check endpoint on port 8082.<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ curl <span class="operator">-s</span> http://<span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">8082</span>/healthcheck | \</span><br><span class="line">    python -m json.tool</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">"deadlocks"</span>: &#123;</span><br><span class="line">        <span class="string">"healthy"</span>: <span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">"mysql"</span>: &#123;</span><br><span class="line">        <span class="string">"healthy"</span>: <span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">"presto"</span>: &#123;</span><br><span class="line">        <span class="string">"healthy"</span>: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>If that all looks well the web interface is configured to be exposed on port 8081.<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ curl http://<span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">8081</span>/app</span><br></pre></td></tr></table></figure></p>
<p>Thank you for taking the time to read this post. If you’re considering using Digital Ocean, the hosting provider this blog is hosted on, please consider using this link to sign up.<br>转 <a href="http://tech.marksblogg.com/presto-parquet-airpal.html" target="_blank" rel="external">http://tech.marksblogg.com/presto-parquet-airpal.html</a></p>

      
    </div>

    <footer class="post-footer">
    
      
        <div class="post-tags">
          
            <a href="/tags/parquet/" rel="tag">#parquet</a>
          
            <a href="/tags/presto/" rel="tag">#presto</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2016/01/27/spark-sort-shuffle-analyse/" rel="next" title="Spark Sort Based Shuffle内存分析">
                <i class="fa fa-chevron-left"></i> Spark Sort Based Shuffle内存分析
              </a>
            
          </div>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2016/02/19/service-discovery-consul-and-consul-template/" rel="prev" title="Service discovery with consul and consul-template">
                Service discovery with consul and consul-template <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
        <div class="ds-share flat" data-thread-key="2016/02/04/presto-parquet-airpal/"
     data-title="Presto, Parquet & Airpal"
     data-content=""
     data-url="http://blog.djstudy.net/2016/02/04/presto-parquet-airpal/">
  <div class="ds-share-inline">
    <ul  class="ds-share-icons-16">

      <li data-toggle="ds-share-icons-more"><a class="ds-more" href="javascript:void(0);">分享到：</a></li>
      <li><a class="ds-weibo" href="javascript:void(0);" data-service="weibo">微博</a></li>
      <li><a class="ds-qzone" href="javascript:void(0);" data-service="qzone">QQ空间</a></li>
      <li><a class="ds-qqt" href="javascript:void(0);" data-service="qqt">腾讯微博</a></li>
      <li><a class="ds-wechat" href="javascript:void(0);" data-service="wechat">微信</a></li>

    </ul>
    <div class="ds-share-icons-more">
    </div>
  </div>
</div>
      
    </div>
  </div>


          </div>
          
          


          
  <div class="comments" id="comments">
    
      <div class="ds-thread" data-thread-key="2016/02/04/presto-parquet-airpal/"
           data-title="Presto, Parquet & Airpal" data-url="http://blog.djstudy.net/2016/02/04/presto-parquet-airpal/">
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/author.jpg"
               alt="东杰" />
          <p class="site-author-name" itemprop="name">东杰</p>
          <p class="site-description motion-element" itemprop="description"></p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">10</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          <div class="site-state-item site-state-categories">
            <a href="/categories">
              <span class="site-state-item-count">6</span>
              <span class="site-state-item-name">分类</span>
              </a>
          </div>

          <div class="site-state-item site-state-tags">
            <a href="/tags">
              <span class="site-state-item-count">11</span>
              <span class="site-state-item-name">标签</span>
              </a>
          </div>

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/hivefans" target="_blank">
                  
                    <i class="fa fa-github"></i> GitHub
                  
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/sdj1225" target="_blank">
                  
                    <i class="fa fa-globe"></i> weibo
                  
                </a>
              </span>
            
          
        </div>

        
        

        <div class="links-of-author motion-element">
          
            <p class="site-author-name">友情链接</p>
            
              <span class="links-of-author-item">
                <a href="http://macshuo.com/" target="_blank">MacTalk</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://slaytanic.blog.51cto.com/" target="_blank">实践检验</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://www.adintellig.com/" target="_blank">Manny很忙</a>
              </span>
            
          
        </div>

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc-indicator-top post-toc-indicator">
            <i class="fa fa-angle-double-up"></i>
          </div>
          <div class="post-toc">
            
              
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Launching_a_Hadoop_Cluster_in_Docker_Containers"><span class="nav-number">1.</span> <span class="nav-text">Launching a Hadoop Cluster in Docker Containers</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Getting_Hive_u2019s_Metastore_Up_and_Running"><span class="nav-number">2.</span> <span class="nav-text">Getting Hive’s Metastore Up and Running</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Getting_some_data_to_play_with"><span class="nav-number">3.</span> <span class="nav-text">Getting some data to play with</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Presto_Up_and_Running"><span class="nav-number">4.</span> <span class="nav-text">Presto Up and Running</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Presto_u2019s_CLI_Up_and_Running"><span class="nav-number">5.</span> <span class="nav-text">Presto’s CLI Up and Running</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Executing_Queries_in_Presto"><span class="nav-number">6.</span> <span class="nav-text">Executing Queries in Presto</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Airpal_3A_A_Web_Interface_for_Presto"><span class="nav-number">7.</span> <span class="nav-text">Airpal: A Web Interface for Presto</span></a></li></ol></div>
            
          </div>
          <div class="post-toc-indicator-bottom post-toc-indicator">
            <i class="fa fa-angle-double-down"></i>
          </div>
        </section>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="icon-next-heart fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">东杰</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>
<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
本站总访问量 <span id="busuanzi_value_site_pv"></span> &nbsp&nbsp&nbsp
您是第<span id="busuanzi_value_site_uv"></span>个来到的小伙伴


      </div>
    </footer>

    <div class="back-to-top"></div>
  </div>

  


  



  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  <script type="text/javascript" src="/vendors/velocity/velocity.min.js"></script>

  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js"></script>

  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=0.5.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=0.5.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=0.5.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=0.5.0"></script>



  
  
<script type="text/javascript" src="/js/src/scrollspy.js?v=0.5.0"></script>

<script type="text/javascript" id="sidebar.toc.highlight">
  $(document).ready(function () {
    var tocSelector = '.post-toc';
    var $tocSelector = $(tocSelector);
    var activeCurrentSelector = '.active-current';

    $tocSelector
      .on('activate.bs.scrollspy', function () {
        var $currentActiveElement = $(tocSelector + ' .active').last();

        removeCurrentActiveClass();
        $currentActiveElement.addClass('active-current');

        $tocSelector[0].scrollTop = $currentActiveElement.position().top;
      })
      .on('clear.bs.scrollspy', function () {
        removeCurrentActiveClass();
      });

    function removeCurrentActiveClass () {
      $(tocSelector + ' ' + activeCurrentSelector)
        .removeClass(activeCurrentSelector.substring(1));
    }

    function processTOC () {
      getTOCMaxHeight();
      toggleTOCOverflowIndicators();
    }

    function getTOCMaxHeight () {
      var height = $('.sidebar').height() -
                   $tocSelector.position().top -
                   $('.post-toc-indicator-bottom').height();

      $tocSelector.css('height', height);

      return height;
    }

    function toggleTOCOverflowIndicators () {
      tocOverflowIndicator(
        '.post-toc-indicator-top',
        $tocSelector.scrollTop() > 0 ? 'show' : 'hide'
      );

      tocOverflowIndicator(
        '.post-toc-indicator-bottom',
        $tocSelector.scrollTop() >= $tocSelector.find('ol').height() - $tocSelector.height() ? 'hide' : 'show'
      )
    }

    $(document).on('sidebar.motion.complete', function () {
      processTOC();
    });

    $('body').scrollspy({ target: tocSelector });
    $(window).on('resize', function () {
      if ( $('.sidebar').hasClass('sidebar-active') ) {
        processTOC();
      }
    });

    onScroll($tocSelector);

    function onScroll (element) {
      element.on('mousewheel DOMMouseScroll', function (event) {
          var oe = event.originalEvent;
          var delta = oe.wheelDelta || -oe.detail;

          this.scrollTop += ( delta < 0 ? 1 : -1 ) * 30;
          event.preventDefault();

          toggleTOCOverflowIndicators();
      });
    }

    function tocOverflowIndicator (indicator, action) {
      var $indicator = $(indicator);
      var opacity = action === 'show' ? 1 : 0;
      $indicator.velocity ?
        $indicator.velocity('stop').velocity({
          opacity: opacity
        }, { duration: 100 }) :
        $indicator.stop().animate({
          opacity: opacity
        }, 100);
    }

  });
</script>

<script type="text/javascript" id="sidebar.nav">
  $(document).ready(function () {
    var html = $('html');
    var TAB_ANIMATE_DURATION = 200;
    var hasVelocity = $.isFunction(html.velocity);

    $('.sidebar-nav li').on('click', function () {
      var item = $(this);
      var activeTabClassName = 'sidebar-nav-active';
      var activePanelClassName = 'sidebar-panel-active';
      if (item.hasClass(activeTabClassName)) {
        return;
      }

      var currentTarget = $('.' + activePanelClassName);
      var target = $('.' + item.data('target'));

      hasVelocity ?
        currentTarget.velocity('transition.slideUpOut', TAB_ANIMATE_DURATION, function () {
          target
            .velocity('stop')
            .velocity('transition.slideDownIn', TAB_ANIMATE_DURATION)
            .addClass(activePanelClassName);
        }) :
        currentTarget.animate({ opacity: 0 }, TAB_ANIMATE_DURATION, function () {
          currentTarget.hide();
          target
            .stop()
            .css({'opacity': 0, 'display': 'block'})
            .animate({ opacity: 1 }, TAB_ANIMATE_DURATION, function () {
              currentTarget.removeClass(activePanelClassName);
              target.addClass(activePanelClassName);
            });
        });

      item.siblings().removeClass(activeTabClassName);
      item.addClass(activeTabClassName);
    });

    $('.post-toc a').on('click', function (e) {
      e.preventDefault();
      var targetSelector = NexT.utils.escapeSelector(this.getAttribute('href'));
      var offset = $(targetSelector).offset().top;
      hasVelocity ?
        html.velocity('stop').velocity('scroll', {
          offset: offset  + 'px',
          mobileHA: false
        }) :
        $('html, body').stop().animate({
          scrollTop: offset
        }, 500);
    });

    // Expand sidebar on post detail page by default, when post has a toc.
    NexT.motion.middleWares.sidebar = function () {
      var $tocContent = $('.post-toc-content');

      if (CONFIG.sidebar === 'post') {
        if ($tocContent.length > 0 && $tocContent.html().trim().length > 0) {
          NexT.utils.displaySidebar();
        }
      }
    };
  });
</script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=0.5.0"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"hivefans"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
      <script src="/vendors/ua-parser-js/dist/ua-parser.min.js"></script>
      <script src="/js/src/hook-duoshuo.js"></script>
    
  





  
  

  
  


</body>
</html>
