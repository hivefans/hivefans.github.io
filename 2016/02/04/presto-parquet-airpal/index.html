<!DOCTYPE html>
<html lang=zh>
<head>
    <meta charset="utf-8">
    
    <title>Presto, Parquet &amp; Airpal | 东杰书屋</title>
    
    
        <meta name="keywords" content="presto,parquet" />
    
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="I came across a blog post from Brandon Harris recently where he discussed a credit card fraud detection project he’d been working on with a team at the University of Chicago. In the post he described">
<meta name="keywords" content="presto,parquet">
<meta property="og:type" content="article">
<meta property="og:title" content="Presto, Parquet &amp; Airpal">
<meta property="og:url" content="https://blog.djstudy.net/2016/02/04/presto-parquet-airpal/index.html">
<meta property="og:site_name" content="东杰书屋">
<meta property="og:description" content="I came across a blog post from Brandon Harris recently where he discussed a credit card fraud detection project he’d been working on with a team at the University of Chicago. In the post he described">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2016-02-04T11:43:10.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Presto, Parquet &amp; Airpal">
<meta name="twitter:description" content="I came across a blog post from Brandon Harris recently where he discussed a credit card fraud detection project he’d been working on with a team at the University of Chicago. In the post he described">
    

    
        <link rel="alternate" href="/atom.xml" title="东杰书屋" type="application/atom+xml" />
    

    
        <link rel="icon" href="/favicon.ico" />
    

    <link rel="stylesheet" href="/libs/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="/libs/open-sans/styles.css">
    <link rel="stylesheet" href="/libs/source-code-pro/styles.css">

    <link rel="stylesheet" href="/css/style.css">
    <script src="/libs/jquery/2.1.3/jquery.min.js"></script>
    <script src="/libs/jquery/plugins/cookie/1.4.1/jquery.cookie.js"></script>
    
    
        <link rel="stylesheet" href="/libs/lightgallery/css/lightgallery.min.css">
    
    
        <link rel="stylesheet" href="/libs/justified-gallery/justifiedGallery.min.css">
    
    
    
    
        <script>
var _hmt = _hmt || [];
(function() {
    var hm = document.createElement("script");
    hm.src = "//hm.baidu.com/hm.js?05207dc6d0c785fb39a80bb5af7c3d8a# enter Baidu Analytics hash key";
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(hm, s);
})();
</script>

    


    
        <script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    
</head>

<body>
    <div id="container">
        <header id="header">
    <div id="header-main" class="header-inner">
        <div class="outer">
            <a href="/" id="logo">
                <i class="logo"></i>
                <span class="site-title">东杰书屋</span>
            </a>
            <nav id="main-nav">
                
                    <a class="main-nav-link" href="/">首页</a>
                
                    <a class="main-nav-link" href="/archives">归档</a>
                
                    <a class="main-nav-link" href="/categories">分类</a>
                
                    <a class="main-nav-link" href="/tags">标签</a>
                
                    <a class="main-nav-link" href="/about">关于</a>
                
                    <a class="main-nav-link" href="/arch">架构</a>
                
            </nav>
            
            <div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="Search" />
        <button type="submit" class="search-form-submit"></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="Type something..." />
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: 'Posts',
            PAGES: 'Pages',
            CATEGORIES: 'Categories',
            TAGS: 'Tags',
            UNTITLED: '(Untitled)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
<script src="/js/insight.js"></script>

</div>
        </div>
    </div>
    <div id="main-nav-mobile" class="header-sub header-inner">
        <table class="menu outer">
            <tr>
                
                    <td><a class="main-nav-link" href="/">首页</a></td>
                
                    <td><a class="main-nav-link" href="/archives">归档</a></td>
                
                    <td><a class="main-nav-link" href="/categories">分类</a></td>
                
                    <td><a class="main-nav-link" href="/tags">标签</a></td>
                
                    <td><a class="main-nav-link" href="/about">关于</a></td>
                
                    <td><a class="main-nav-link" href="/arch">架构</a></td>
                
                <td>
                    
    <div class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="Search" />
    </div>

                </td>
            </tr>
        </table>
    </div>
</header>

        <div class="outer">
            
            
                <aside id="sidebar">
   
        
    <div class="widget-wrap" id='categories'>
        <h3 class="widget-title">
            <span>categories</span>
            &nbsp;
            <a id='allExpand' href="#">
                <i class="fa fa-angle-double-down fa-2x"></i>
            </a>
        </h3>
        
        
        
         <ul class="unstyled" id="tree" > 
                    <li class="directory open">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder-open"></i>
                            &nbsp;
                            big data
                        </a>
                         <ul class="unstyled" id="tree" >  <li class="file"><a href="/2016/07/27/hbase-minor-vs-major-compaction/">hbase 压缩合并中的minor与major区别</a></li>  <li class="file"><a href="/2016/09/28/hbase-rit/">hbase中的RIT的那些事</a></li>  <li class="file active"><a href="/2016/02/04/presto-parquet-airpal/">Presto, Parquet & Airpal</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            distribution 
                        </a>
                         <ul class="unstyled" id="tree" >  <li class="file"><a href="/2016/02/19/service-discovery-consul-and-consul-template/">Service discovery with consul and consul-template</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            elasticsearch
                        </a>
                         <ul class="unstyled" id="tree" >  <li class="file"><a href="/2016/07/27/es-flush-vs-refresh/">elasticsearch中的refresh和flush区别</a></li>  <li class="file"><a href="/2017/04/27/es-shard-interaction/">Elasticsearch 分片交互过程详解</a></li>  <li class="file"><a href="/2016/02/27/how-many-shards-index/">Optimizing Elasticsearch-How Many Shards per Index</a></li>  <li class="file"><a href="/2017/06/06/openresty-kibana-post/">使用openresty获取kibana查询post参数</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            hadoop
                        </a>
                         <ul class="unstyled" id="tree" >  <li class="file"><a href="/2016/01/24/hdp-spark-shell-error/">ambari hdp中部署apache spark运行spark shell遇到的错误解决</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            scala
                        </a>
                         <ul class="unstyled" id="tree" >  <li class="file"><a href="/2016/03/16/scala-note-1/">scala学习笔记(一)</a></li>  <li class="file"><a href="/2016/03/19/scala-note-2/">scala学习笔记(二)</a></li>  <li class="file"><a href="/2016/07/10/scala-note-3/">scala学习笔记(三)</a></li>  <li class="file"><a href="/2016/01/24/scala-rumen-biji/">scala入门笔记</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            spark
                        </a>
                         <ul class="unstyled" id="tree" >  <li class="file"><a href="/2016/01/24/spark-convert-text-parquet/">将 Spark 中的文本转换为 Parquet 以提升性能</a></li>  <li class="file"><a href="/2016/01/24/spark-ha/">Spark Standalone模式HA环境搭建</a></li>  <li class="file"><a href="/2016/01/24/spark-on-yarn/">spark on yarn</a></li>  <li class="file"><a href="/2016/01/27/spark-sort-shuffle-analyse/">Spark Sort Based Shuffle内存分析</a></li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            数据结构与算法
                        </a>
                         <ul class="unstyled" id="tree" >  <li class="file"><a href="/2016/09/21/comb-sort/">comb sort(梳排序)</a></li>  </ul> 
                    </li> 
                     </ul> 
    </div>
    <script>
        $(document).ready(function() {
            var iconFolderOpenClass  = 'fa-folder-open';
            var iconFolderCloseClass = 'fa-folder';
            var iconAllExpandClass = 'fa-angle-double-down';
            var iconAllPackClass = 'fa-angle-double-up';
            // Handle directory-tree expansion:
            // 左键单独展开目录
            $(document).on('click', '#categories a[data-role="directory"]', function (event) {
                event.preventDefault();

                var icon = $(this).children('.fa');
                var expanded = icon.hasClass(iconFolderOpenClass);
                var subtree = $(this).siblings('ul');
                icon.removeClass(iconFolderOpenClass).removeClass(iconFolderCloseClass);
                if (expanded) {
                    if (typeof subtree != 'undefined') {
                        subtree.slideUp({ duration: 100 });
                    }
                    icon.addClass(iconFolderCloseClass);
                } else {
                    if (typeof subtree != 'undefined') {
                        subtree.slideDown({ duration: 100 });
                    }
                    icon.addClass(iconFolderOpenClass);
                }
            });
            // 右键展开下属所有目录
            $('#categories a[data-role="directory"]').bind("contextmenu", function(event){
                event.preventDefault();
                
                var icon = $(this).children('.fa');
                var expanded = icon.hasClass(iconFolderOpenClass);
                var listNode = $(this).siblings('ul');
                var subtrees = $.merge(listNode.find('li ul'), listNode);
                var icons = $.merge(listNode.find('.fa'), icon);
                icons.removeClass(iconFolderOpenClass).removeClass(iconFolderCloseClass);
                if(expanded) {
                    subtrees.slideUp({ duration: 100 });
                    icons.addClass(iconFolderCloseClass);
                } else {
                    subtrees.slideDown({ duration: 100 });
                    icons.addClass(iconFolderOpenClass);
                }
            })
            // 展开关闭所有目录按钮
            $(document).on('click', '#allExpand', function (event) {
                event.preventDefault();
                
                var icon = $(this).children('.fa');
                var expanded = icon.hasClass(iconAllExpandClass);
                icon.removeClass(iconAllExpandClass).removeClass(iconAllPackClass);
                if(expanded) {
                    $('#sidebar .fa.fa-folder').removeClass('fa-folder').addClass('fa-folder-open')
                    $('#categories li ul').slideDown({ duration: 100 });
                    icon.addClass(iconAllPackClass);
                } else {
                    $('#sidebar .fa.fa-folder-open').removeClass('fa-folder-open').addClass('fa-folder')
                    $('#categories li ul').slideUp({ duration: 100 });
                    icon.addClass(iconAllExpandClass);
                }
            });  
        });
    </script>

    
    <div id="toTop" class="fa fa-angle-up"></div>
</aside>
            
            <section id="main"><article id="post-presto-parquet-airpal" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
                    <div class="article-meta">
                        
    <div class="article-category">
    	<i class="fa fa-folder"></i>
        <a class="article-category-link" href="/categories/big-data/">big data</a>
    </div>

                        
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/tags/parquet/">parquet</a>, <a class="tag-link" href="/tags/presto/">presto</a>
    </div>

                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2016/02/04/presto-parquet-airpal/">
            <time datetime="2016-02-04T10:53:35.000Z" itemprop="datePublished">2016-02-04</time>
        </a>
    </div>


                        
                            <i class="fa fa-bar-chart"></i>
                            <span id="busuanzi_container_site_pv"><span id="busuanzi_value_page_pv"></span></span>    
                        
                        
                            <div class="article-meta-button">
                                <a href='http://git.djstudy.net/hivefans/blog/raw/master/source/_posts/presto-parquet-airpal.md'> Source </a>
                            </div>
                            <div class="article-meta-button">
                                <a href='http://git.djstudy.net/hivefans/blog/edit/master/source/_posts/presto-parquet-airpal.md'> Edit </a>
                            </div>
                            <div class="article-meta-button">
                                <a href='http://git.djstudy.net/hivefans/blog/commits/master/source/_posts/presto-parquet-airpal.md'> History </a>
                            </div>
                        
                    </div>
                
                
    
        <h1 class="article-title" itemprop="name">
            Presto, Parquet &amp; Airpal
        </h1>
    

            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
        
            
        
        
            <p>I came across a <a href="http://brandonharris.io/evaluating-big-data-performance-of-prestodb-and-parquet-on-s3-storage/" target="_blank" rel="external">blog post</a> from Brandon Harris recently where he discussed a credit card fraud detection project he’d been working on with a team at the University of Chicago. In the post he described how Presto and Parquet-formatted files had gone a long way to speeding up ad-hoc queries against a ~250GB dataset he’s working with.</p>
<p>Presto was born at Facebook and was <a href="https://github.com/facebook/presto" target="_blank" rel="external">open sourced</a> within a year of it’s inception. It’s a distributed query engine capable of running interactive queries against big data sources. There’s support for data sources such as Hive, Kafka, PostgreSQL, Redis and Cassandra <a href="https://prestodb.io/docs/current/connector.html" target="_blank" rel="external">among many others</a>. Netflix has blogged about their positive experiences with Presto on a <a href="http://techblog.netflix.com/2014/10/using-presto-in-our-big-data-platform.html" target="_blank" rel="external">10PB Data Warehouse</a> they’ve got that’s happily handling 2,500 ad-hoc queries a day.</p>
<p>In Brandon’s blog post there is a chart showing a query that’s executed in Hive against data stored in CSV format taking 130 seconds and then the same query run via Presto against data stored in Parquet format taking less than 5 seconds. I trust the measurements of his queries are accurate but what I’m interested in is what is involved in getting an environment up to run these sorts of queries.</p>
<p>As of this writing Bigtop’s <a href="https://issues.apache.org/jira/browse/BIGTOP-1561" target="_blank" rel="external">Presto support isn’t ready</a> (though <a href="https://github.com/apache/bigtop/pull/32/files" target="_blank" rel="external">pull requests</a> are being worked on) so to get an environment up and running locally I’ll have to perform some of the installation steps manually.</p>
<h2 id="Launching_a_Hadoop_Cluster_in_Docker_Containers"><a href="#Launching_a_Hadoop_Cluster_in_Docker_Containers" class="headerlink" title="Launching a Hadoop Cluster in Docker Containers"></a>Launching a Hadoop Cluster in Docker Containers</h2><p>This process begins with a fresh Ubuntu 15 installation acting as the host for Docker containers that a Hadoop cluster will live within. I discuss getting Ubuntu 15 ready to run Docker in my <a href="http://tech.marksblogg.com/hadoop-up-and-running.html#bigtop-run-a-dockerized-hadoop-cluster" target="_blank" rel="external">Hadoop Up and Running</a> blog post.</p>
<p>With Docker ready I’ll checkout the Bigtop git repository and launch Ubuntu 14.04-based containers (as of this writing this is the latest <a href="https://hub.docker.com/r/bigtop/deploy/tags/" target="_blank" rel="external">supported version</a> of Ubuntu on Intel-based systems).<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$ git <span class="built_in">clone</span> https://github.com/apache/bigtop.git</div><div class="line">$ <span class="built_in">cd</span> bigtop/bigtop-deploy/vm/vagrant-puppet-docker/</div><div class="line">$ sudo docker pull bigtop/deploy:ubuntu-14.04</div><div class="line">$ vi vagrantconfig.yaml</div></pre></td></tr></table></figure></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">docker:</div><div class="line">        memory_size: <span class="string">"4096"</span></div><div class="line">        image:  <span class="string">"bigtop/deploy:ubuntu-14.04"</span></div><div class="line"></div><div class="line">boot2docker:</div><div class="line">        memory_size: <span class="string">"4096"</span></div><div class="line">        number_cpus: <span class="string">"1"</span></div><div class="line"></div><div class="line">repo: <span class="string">"http://bigtop-repos.s3.amazonaws.com/releases/1.0.0/ubuntu/trusty/x86_64"</span></div><div class="line">distro: debian</div><div class="line">components: [hadoop, yarn, hive]</div><div class="line">namenode_ui_port: <span class="string">"50070"</span></div><div class="line">yarn_ui_port: <span class="string">"8088"</span></div><div class="line">hbase_ui_port: <span class="string">"60010"</span></div><div class="line">enable_local_repo: <span class="literal">false</span></div><div class="line">smoke_test_components: [mapreduce, pig]</div><div class="line">jdk: <span class="string">"openjdk-7-jdk"</span></div></pre></td></tr></table></figure>
<p>While I was writing this blog post Bigtop 1.1 was <a href="https://github.com/apache/bigtop/commit/dbf098fe56246cf44ca8d9c2940f2c5c59df40de" target="_blank" rel="external">being cut</a> and the resources from their 1.1.0 endpoint were returning HTTP 403 messages so I’ve stuck with the 1.0.0 endpoints for now.<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ sudo ./docker-hadoop.sh --create 3</div><div class="line">$ sudo vagrant ssh bigtop1</div></pre></td></tr></table></figure></p>
<h2 id="Getting_Hive_u2019s_Metastore_Up_and_Running"><a href="#Getting_Hive_u2019s_Metastore_Up_and_Running" class="headerlink" title="Getting Hive’s Metastore Up and Running"></a>Getting Hive’s Metastore Up and Running</h2><p>By default the Derby embedded database driver is enabled in the boilerplate Hive configurations provided by Bigtop. This driver can only allow one process at a time to connect to it. If you use it Hive’s Metastore server won’t communicate properly with Presto and you’ll get “does not exist” messages every time you try to access a table.<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> track_metadata_csv;</div><div class="line">... Table hive.default.track_metadata_csv does not exist</div></pre></td></tr></table></figure></p>
<p>For this reason I’ve installed MySQL and used it as the data backend for Hive’s Metastore.<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">$ apt-get install \</div><div class="line">    libmysql-java \</div><div class="line">    mysql-server</div><div class="line">$ ln -s /usr/share/java/mysql-connector-java.jar \</div><div class="line">        /usr/lib/hive/lib/mysql-connector-java.jar</div><div class="line">$ /etc/init.d/mysql start</div><div class="line">$ mysql -uroot -proot -e<span class="string">'CREATE DATABASE hcatalog;'</span></div></pre></td></tr></table></figure></p>
<p>When you install MySQL you’ll be prompted to set a root login and password. I’ve set both values to root in this example. Below is the Hive site configuration file.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ vi /etc/hive/conf/hive-site.xml</div></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0"?&gt;</div><div class="line">&lt;?xml-stylesheet type="text/xsl" href="configuration.xsl"?&gt;</div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.zookeeper.quorum<span class="tag">&lt;/<span class="name">name</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>bigtop1.docker<span class="tag">&lt;/<span class="name">value</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.execution.engine<span class="tag">&lt;/<span class="name">name</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>mr<span class="tag">&lt;/<span class="name">value</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>javax.jdo.option.ConnectionURL<span class="tag">&lt;/<span class="name">name</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>jdbc:mysql://localhost/hcatalog?createDatabaseIfNotExist=true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>javax.jdo.option.ConnectionUserName<span class="tag">&lt;/<span class="name">name</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>root<span class="tag">&lt;/<span class="name">value</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>javax.jdo.option.ConnectionPassword<span class="tag">&lt;/<span class="name">name</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>root<span class="tag">&lt;/<span class="name">value</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>javax.jdo.option.ConnectionDriverName<span class="tag">&lt;/<span class="name">name</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>com.mysql.jdbc.Driver<span class="tag">&lt;/<span class="name">value</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.hwi.war.file<span class="tag">&lt;/<span class="name">name</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>/usr/lib/hive/lib/hive-hwi.war<span class="tag">&lt;/<span class="name">value</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></div></pre></td></tr></table></figure>
<p>I then launched Hive and made sure the Metastore’s database exists.<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hive</div></pre></td></tr></table></figure></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> <span class="keyword">IF</span> <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> metastore_db;</div></pre></td></tr></table></figure>
<p>After that I closed out of Hive and launched it’s Metastore service in the background. You’ll see it binded to port 9083 if it’s running.<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ hive --service metastore &amp;</div><div class="line">$ netstat -an | grep 9083</div></pre></td></tr></table></figure></p>
<h2 id="Getting_some_data_to_play_with"><a href="#Getting_some_data_to_play_with" class="headerlink" title="Getting some data to play with"></a>Getting some data to play with</h2><p>I need some data to play with in this exercise so I dumped the Million Song Dataset to CSV and imported it into HDFS</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ apt-get install sqlite3</div><div class="line">$ wget -c http://labrosa.ee.columbia.edu/millionsong/sites/default/files/AdditionalFiles/track_metadata.db</div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">$ sqlite3 track_metadata.db &lt;&lt;!</div><div class="line">.headers off</div><div class="line">.mode csv</div><div class="line">.output track_metadata.csv</div><div class="line">SELECT track_id,</div><div class="line">     artist_id,</div><div class="line">     artist_familiarity,</div><div class="line">     artist_hotttnesss,</div><div class="line">     duration,</div><div class="line">     year</div><div class="line">FROM songs;</div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ hadoop fs -put \</div><div class="line">    track_metadata.csv \</div><div class="line">    /tmp/track_metadata.csv</div></pre></td></tr></table></figure>
<p>With the CSV file sitting in HDFS I’ll create a Hive table for it. Once that table is created I can create a second, Parquet-formatted table and import the data from the first table into the second.<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hive</div></pre></td></tr></table></figure></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> track_metadata_csv (</div><div class="line">    track_id            <span class="built_in">VARCHAR</span>(<span class="number">18</span>),</div><div class="line">    artist_id           <span class="built_in">VARCHAR</span>(<span class="number">18</span>),</div><div class="line">    artist_familiarity  <span class="built_in">DECIMAL</span>(<span class="number">16</span>, <span class="number">15</span>),</div><div class="line">    artist_hotttnesss   <span class="built_in">DECIMAL</span>(<span class="number">16</span>, <span class="number">15</span>),</div><div class="line">    <span class="keyword">duration</span>            <span class="built_in">DECIMAL</span>(<span class="number">12</span>, <span class="number">8</span>),</div><div class="line">    <span class="keyword">year</span>                <span class="built_in">SMALLINT</span></div><div class="line">)</div><div class="line"><span class="keyword">ROW</span> <span class="keyword">FORMAT</span> <span class="keyword">DELIMITED</span> <span class="keyword">FIELDS</span> <span class="keyword">TERMINATED</span> <span class="keyword">BY</span> <span class="string">','</span>;</div><div class="line"></div><div class="line"><span class="keyword">LOAD</span> <span class="keyword">DATA</span> INPATH <span class="string">'/tmp/track_metadata.csv'</span></div><div class="line"><span class="keyword">INTO</span> <span class="keyword">TABLE</span> track_metadata_csv;</div><div class="line"></div><div class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> track_metadata_parquet (</div><div class="line">    track_id            <span class="built_in">VARCHAR</span>(<span class="number">18</span>),</div><div class="line">    artist_id           <span class="built_in">VARCHAR</span>(<span class="number">18</span>),</div><div class="line">    artist_familiarity  <span class="built_in">DECIMAL</span>(<span class="number">16</span>, <span class="number">15</span>),</div><div class="line">    artist_hotttnesss   <span class="built_in">DECIMAL</span>(<span class="number">16</span>, <span class="number">15</span>),</div><div class="line">    <span class="keyword">duration</span>            <span class="built_in">DECIMAL</span>(<span class="number">12</span>, <span class="number">8</span>),</div><div class="line">    <span class="keyword">year</span>                <span class="built_in">SMALLINT</span></div><div class="line">)</div><div class="line"><span class="keyword">STORED</span> <span class="keyword">AS</span> parquet;</div><div class="line"></div><div class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="keyword">TABLE</span> track_metadata_parquet</div><div class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> track_metadata_csv;</div></pre></td></tr></table></figure>
<p>I now have that table’s metadata stored in Hive’s Metastore and a Parquet-formatted file of that data sitting on HDFS:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">$ hadoop fs -ls \</div><div class="line">    /user/hive/warehouse/track_metadata_parquet</div><div class="line">Found 1 items</div><div class="line">-rw-r--r--   3 root hadoop   45849172 2016-01-31 13:31 /user/hive/warehouse/track_metadata_parquet/000000_0</div><div class="line">$ mysqldump \</div><div class="line">    -uroot \</div><div class="line">    -proot \</div><div class="line">    --no-create-info \</div><div class="line">    --skip-add-locks \</div><div class="line">    --skip-disable-keys \</div><div class="line">    --skip-comments \</div><div class="line">    hcatalog | \</div><div class="line">    grep ^INSERT | \</div><div class="line">    sort</div></pre></td></tr></table></figure></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`CDS`</span> <span class="keyword">VALUES</span> (<span class="number">1</span>),(<span class="number">2</span>);</div><div class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`COLUMNS_V2`</span> <span class="keyword">VALUES</span></div><div class="line">    (<span class="number">1</span>,<span class="literal">NULL</span>,<span class="string">'artist_familiarity'</span>,<span class="string">'decimal(16,15)'</span>,<span class="number">2</span>),</div><div class="line">    (<span class="number">1</span>,<span class="literal">NULL</span>,<span class="string">'artist_hotttnesss'</span>,<span class="string">'decimal(16,15)'</span>,<span class="number">3</span>),</div><div class="line">    (<span class="number">1</span>,<span class="literal">NULL</span>,<span class="string">'artist_id'</span>,<span class="string">'varchar(18)'</span>,<span class="number">1</span>),</div><div class="line">    (<span class="number">1</span>,<span class="literal">NULL</span>,<span class="string">'duration'</span>,<span class="string">'decimal(12,8)'</span>,<span class="number">4</span>),</div><div class="line">    (<span class="number">1</span>,<span class="literal">NULL</span>,<span class="string">'track_id'</span>,<span class="string">'varchar(18)'</span>,<span class="number">0</span>),</div><div class="line">    (<span class="number">1</span>,<span class="literal">NULL</span>,<span class="string">'year'</span>,<span class="string">'smallint'</span>,<span class="number">5</span>),</div><div class="line">    (<span class="number">2</span>,<span class="literal">NULL</span>,<span class="string">'artist_familiarity'</span>,<span class="string">'decimal(16,15)'</span>,<span class="number">2</span>),</div><div class="line">    (<span class="number">2</span>,<span class="literal">NULL</span>,<span class="string">'artist_hotttnesss'</span>,<span class="string">'decimal(16,15)'</span>,<span class="number">3</span>),</div><div class="line">    (<span class="number">2</span>,<span class="literal">NULL</span>,<span class="string">'artist_id'</span>,<span class="string">'varchar(18)'</span>,<span class="number">1</span>),</div><div class="line">    (<span class="number">2</span>,<span class="literal">NULL</span>,<span class="string">'duration'</span>,<span class="string">'decimal(12,8)'</span>,<span class="number">4</span>),</div><div class="line">    (<span class="number">2</span>,<span class="literal">NULL</span>,<span class="string">'track_id'</span>,<span class="string">'varchar(18)'</span>,<span class="number">0</span>),</div><div class="line">    (<span class="number">2</span>,<span class="literal">NULL</span>,<span class="string">'year'</span>,<span class="string">'smallint'</span>,<span class="number">5</span>);</div><div class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`DBS`</span> <span class="keyword">VALUES</span></div><div class="line">    (<span class="number">1</span>,<span class="string">'Default Hive database'</span>,<span class="string">'hdfs://bigtop1.docker:8020/user/hive/warehouse'</span>,<span class="string">'default'</span>,<span class="string">'public'</span>,<span class="string">'ROLE'</span>),</div><div class="line">    (<span class="number">2</span>,<span class="literal">NULL</span>,<span class="string">'hdfs://bigtop1.docker:8020/user/hive/warehouse/metastore_db.db'</span>,<span class="string">'metastore_db'</span>,<span class="string">'root'</span>,<span class="string">'USER'</span>);</div><div class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`GLOBAL_PRIVS`</span> <span class="keyword">VALUES</span> (<span class="number">1</span>,<span class="number">1454255378</span>,<span class="number">1</span>,<span class="string">'admin'</span>,<span class="string">'ROLE'</span>,<span class="string">'admin'</span>,<span class="string">'ROLE'</span>,<span class="string">'All'</span>);</div><div class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`ROLES`</span> <span class="keyword">VALUES</span></div><div class="line">    (<span class="number">1</span>,<span class="number">1454255378</span>,<span class="string">'admin'</span>,<span class="string">'admin'</span>),</div><div class="line">    (<span class="number">2</span>,<span class="number">1454255378</span>,<span class="string">'public'</span>,<span class="string">'public'</span>);</div><div class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`SDS`</span> <span class="keyword">VALUES</span></div><div class="line">    (<span class="number">1</span>,<span class="number">1</span>,<span class="string">'org.apache.hadoop.mapred.TextInputFormat'</span>,<span class="string">'\0'</span>,<span class="string">'\0'</span>,<span class="string">'hdfs://bigtop1.docker:8020/user/hive/warehouse/track_metadata_csv'</span>,<span class="number">-1</span>,<span class="string">'org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat'</span>,<span class="number">1</span>),</div><div class="line">    (<span class="number">2</span>,<span class="number">2</span>,<span class="string">'org.apache.hadoop.hive.ql.io.parquet.MapredParquetInputFormat'</span>,<span class="string">'\0'</span>,<span class="string">'\0'</span>,<span class="string">'hdfs://bigtop1.docker:8020/user/hive/warehouse/track_metadata_parquet'</span>,<span class="number">-1</span>,<span class="string">'org.apache.hadoop.hive.ql.io.parquet.MapredParquetOutputFormat'</span>,<span class="number">2</span>);</div><div class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`SEQUENCE_TABLE`</span> <span class="keyword">VALUES</span></div><div class="line">    (<span class="string">'org.apache.hadoop.hive.metastore.model.MColumnDescriptor'</span>,<span class="number">6</span>),</div><div class="line">    (<span class="string">'org.apache.hadoop.hive.metastore.model.MDatabase'</span>,<span class="number">6</span>),</div><div class="line">    (<span class="string">'org.apache.hadoop.hive.metastore.model.MGlobalPrivilege'</span>,<span class="number">6</span>),</div><div class="line">    (<span class="string">'org.apache.hadoop.hive.metastore.model.MRole'</span>,<span class="number">6</span>),</div><div class="line">    (<span class="string">'org.apache.hadoop.hive.metastore.model.MSerDeInfo'</span>,<span class="number">6</span>),</div><div class="line">    (<span class="string">'org.apache.hadoop.hive.metastore.model.MStorageDescriptor'</span>,<span class="number">6</span>),</div><div class="line">    (<span class="string">'org.apache.hadoop.hive.metastore.model.MTable'</span>,<span class="number">6</span>),</div><div class="line">    (<span class="string">'org.apache.hadoop.hive.metastore.model.MVersionTable'</span>,<span class="number">6</span>);</div><div class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`SERDES`</span> <span class="keyword">VALUES</span></div><div class="line">    (<span class="number">1</span>,<span class="literal">NULL</span>,<span class="string">'org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe'</span>),</div><div class="line">    (<span class="number">2</span>,<span class="literal">NULL</span>,<span class="string">'org.apache.hadoop.hive.ql.io.parquet.serde.ParquetHiveSerDe'</span>);</div><div class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`SERDE_PARAMS`</span> <span class="keyword">VALUES</span></div><div class="line">    (<span class="number">1</span>,<span class="string">'field.delim'</span>,<span class="string">','</span>),</div><div class="line">    (<span class="number">1</span>,<span class="string">'serialization.format'</span>,<span class="string">','</span>),</div><div class="line">    (<span class="number">2</span>,<span class="string">'serialization.format'</span>,<span class="string">'1'</span>);</div><div class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`TABLE_PARAMS`</span> <span class="keyword">VALUES</span></div><div class="line">    (<span class="number">1</span>,<span class="string">'COLUMN_STATS_ACCURATE'</span>,<span class="string">'true'</span>),</div><div class="line">    (<span class="number">1</span>,<span class="string">'numFiles'</span>,<span class="string">'2'</span>),</div><div class="line">    (<span class="number">1</span>,<span class="string">'numRows'</span>,<span class="string">'0'</span>),</div><div class="line">    (<span class="number">1</span>,<span class="string">'rawDataSize'</span>,<span class="string">'0'</span>),</div><div class="line">    (<span class="number">1</span>,<span class="string">'totalSize'</span>,<span class="string">'161179824'</span>),</div><div class="line">    (<span class="number">1</span>,<span class="string">'transient_lastDdlTime'</span>,<span class="string">'1454255466'</span>),</div><div class="line">    (<span class="number">2</span>,<span class="string">'COLUMN_STATS_ACCURATE'</span>,<span class="string">'true'</span>),</div><div class="line">    (<span class="number">2</span>,<span class="string">'numFiles'</span>,<span class="string">'2'</span>),</div><div class="line">    (<span class="number">2</span>,<span class="string">'numRows'</span>,<span class="string">'2000000'</span>),</div><div class="line">    (<span class="number">2</span>,<span class="string">'rawDataSize'</span>,<span class="string">'12000000'</span>),</div><div class="line">    (<span class="number">2</span>,<span class="string">'totalSize'</span>,<span class="string">'136579903'</span>),</div><div class="line">    (<span class="number">2</span>,<span class="string">'transient_lastDdlTime'</span>,<span class="string">'1454255498'</span>);</div><div class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`TBLS`</span> <span class="keyword">VALUES</span></div><div class="line">    (<span class="number">1</span>,<span class="number">1454255462</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="string">'root'</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="string">'track_metadata_csv'</span>,<span class="string">'MANAGED_TABLE'</span>,<span class="literal">NULL</span>,<span class="literal">NULL</span>),</div><div class="line">    (<span class="number">2</span>,<span class="number">1454255471</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="string">'root'</span>,<span class="number">0</span>,<span class="number">2</span>,<span class="string">'track_metadata_parquet'</span>,<span class="string">'MANAGED_TABLE'</span>,<span class="literal">NULL</span>,<span class="literal">NULL</span>);</div><div class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`VERSION`</span> <span class="keyword">VALUES</span> (<span class="number">1</span>,<span class="string">'0.14.0'</span>,<span class="string">'Set by MetaStore'</span>);</div></pre></td></tr></table></figure>
<h2 id="Presto_Up_and_Running"><a href="#Presto_Up_and_Running" class="headerlink" title="Presto Up and Running"></a>Presto Up and Running</h2><p>Presto requires Java 8 so I’ll install that first.<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ add-apt-repository ppa:webupd8team/java</div><div class="line">$ apt-get update</div><div class="line">$ apt-get install oracle-java8-installer</div></pre></td></tr></table></figure></p>
<p>I have yet to see recent Debian packages for Presto so I’ll download the binaries instead.<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ <span class="built_in">cd</span> ~</div><div class="line">$ wget -c https://repo1.maven.org/maven2/com/facebook/presto/presto-server/0.133/presto-server-0.133.tar.gz</div><div class="line">$ tar xzf presto-server-0.133.tar.gz</div></pre></td></tr></table></figure></p>
<p>Presto requires a data folder for it to store locks, logs and a few other items and also requires a number of configuration files before it can begin to work properly.<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ mkdir -p /root/datap</div><div class="line">$ mkdir -p ~/presto-server-0.133/etc/catalog</div><div class="line">$ <span class="built_in">cd</span> ~/presto-server-0.133/etc</div></pre></td></tr></table></figure></p>
<p>Normally I wouldn’t suggest creating a data folder in the root partition but this work is all taking place in a Docker container that has exposed 13GB of space on the root partition.<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">$ df -H</div><div class="line">Filesystem      Size  Used Avail Use% Mounted on</div><div class="line">none             13G  6.4G  5.6G  54% /</div><div class="line">tmpfs           4.2G  8.2k  4.2G   1% /dev</div><div class="line">tmpfs           4.2G     0  4.2G   0% /sys/fs/cgroup</div><div class="line">/dev/sda1        13G  6.4G  5.6G  54% /vagrant</div><div class="line">shm              68M     0   68M   0% /dev/shm</div></pre></td></tr></table></figure></p>
<p>Next I need to create six configuration files. Below is an outline of where they live within the ~/presto-server-0.133/etc folder:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">$ tree ~/presto-server-0.133/etc</div><div class="line">etc</div><div class="line">|-- catalog</div><div class="line">|   |-- hive.properties</div><div class="line">|   `-- jmx.properties</div><div class="line">|-- config.properties</div><div class="line">|-- jvm.config</div><div class="line">|-- log.properties</div><div class="line">`-- node.properties</div></pre></td></tr></table></figure></p>
<p>Here are the commands to set the contents on each of the configuration files.<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ vi ~/presto-server-0.133/etc/config.properties</div></pre></td></tr></table></figure></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">coordinator=<span class="literal">true</span></div><div class="line">node-scheduler.include-coordinator=<span class="literal">true</span></div><div class="line">http-server.http.port=8080</div><div class="line">query.max-memory=800MB</div><div class="line">query.max-memory-per-node=200MB</div><div class="line">discovery-server.enabled=<span class="literal">true</span></div><div class="line">discovery.uri=http://127.0.0.1:8080</div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ vi ~/presto-server-0.133/etc/jvm.config</div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">-server</div><div class="line">-Xmx800M</div><div class="line">-XX:+UseG1GC</div><div class="line">-XX:G1HeapRegionSize=32M</div><div class="line">-XX:+UseGCOverheadLimit</div><div class="line">-XX:+ExplicitGCInvokesConcurrent</div><div class="line">-XX:+HeapDumpOnOutOfMemoryError</div><div class="line">-XX:OnOutOfMemoryError=<span class="built_in">kill</span> -9 %p</div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">$ vi ~/presto-server-0.133/etc/log.properties</div><div class="line">com.facebook.presto=INFO</div><div class="line">$ vi ~/presto-server-0.133/etc/node.properties</div><div class="line">node.environment=dev</div><div class="line">node.id=ffffffff-ffff-ffff-ffff-ffffffffffff</div><div class="line">node.data-dir=/root/datap</div></pre></td></tr></table></figure>
<p>The JMX connector provides the ability to query Java Management Extensions (JMX) information from all nodes in a Presto cluster. Presto itself is heavily instrumented via JMX.<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ vi ~/presto-server-0.133/etc/catalog/jmx.properties</div><div class="line">connector.name=jmx</div></pre></td></tr></table></figure></p>
<p>This file allows Presto to know where our Hive Metastore is and which connector to use to communicate with it.<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ vi ~/presto-server-0.133/etc/catalog/hive.properties</div><div class="line">hive.metastore.uri=thrift://bigtop1.docker:9083</div><div class="line">connector.name=hive-hadoop2</div></pre></td></tr></table></figure></p>
<p>With those in place you can launch Presto’s server.<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ ~/presto-server-0.133/bin/launcher start</div></pre></td></tr></table></figure></p>
<p>It should expose a web frontend on port 8080 if it’s running properly.<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ curl localhost:8080</div></pre></td></tr></table></figure></p>
<h2 id="Presto_u2019s_CLI_Up_and_Running"><a href="#Presto_u2019s_CLI_Up_and_Running" class="headerlink" title="Presto’s CLI Up and Running"></a>Presto’s CLI Up and Running</h2><p>I’ll download the CLI JAR file for Presto, rename it to presto and then I can use it to connect to the Presto Server.<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">$ <span class="built_in">cd</span> ~</div><div class="line">$ wget -c https://repo1.maven.org/maven2/com/facebook/presto/presto-cli/0.133/presto-cli-0.133-executable.jar</div><div class="line">$ mv presto-cli-0.133-executable.jar presto</div><div class="line">$ chmod +x presto</div><div class="line">$ ./presto --server localhost:8080 --catalog hive --schema default</div></pre></td></tr></table></figure></p>
<p>I’ll then see if Presto can see the schemas in the Hive Metastore.</p>
<p>show schemas from hive;</p>
<pre><code>Schema
</code></pre><hr>
<p> default<br> information_schema<br> metastore_db<br>(3 rows)</p>
<h2 id="Executing_Queries_in_Presto"><a href="#Executing_Queries_in_Presto" class="headerlink" title="Executing Queries in Presto"></a>Executing Queries in Presto</h2><p>With the CLI communicating with the server properly I’ll run two queries. The first will count how many records per year exist in our million song database using the data in the CSV-backed table and the second will do the same against the Parquet-backed table.<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">SELECT</span> <span class="keyword">year</span>, <span class="keyword">count</span>(*)</div><div class="line"><span class="keyword">FROM</span> track_metadata_csv</div><div class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> <span class="keyword">year</span></div><div class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">year</span>;</div><div class="line"> year | _col1</div><div class="line"><span class="comment">------+--------</span></div><div class="line">    0 | 968848</div><div class="line"> 1922 |     12</div><div class="line"> 1924 |     10</div><div class="line"> ...</div><div class="line"> 2008 |  69540</div><div class="line"> 2009 |  62102</div><div class="line"> 2010 |  18794</div><div class="line"> 2011 |      2</div><div class="line">(90 rows)</div><div class="line"></div><div class="line">Query 20160131_160009_00002_s4z65, FINISHED, 1 node</div><div class="line">Splits: 6 total, 6 done (100.00%)</div><div class="line">0:09 [2M rows, 154MB] [221K rows/s, 17MB/s]</div><div class="line"><span class="keyword">SELECT</span> <span class="keyword">year</span>, <span class="keyword">count</span>(*)</div><div class="line"><span class="keyword">FROM</span> track_metadata_parquet</div><div class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> <span class="keyword">year</span></div><div class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">year</span>;</div><div class="line"> year | _col1</div><div class="line"><span class="comment">------+--------</span></div><div class="line">    0 | 968848</div><div class="line"> 1922 |     12</div><div class="line"> 1924 |     10</div><div class="line"> ...</div><div class="line"> 2008 |  69540</div><div class="line"> 2009 |  62102</div><div class="line"> 2010 |  18794</div><div class="line"> 2011 |      2</div><div class="line">(90 rows)</div><div class="line"></div><div class="line">Query 20160131_160411_00005_s4z65, FINISHED, 1 node</div><div class="line">Splits: 5 total, 5 done (100.00%)</div><div class="line">0:04 [3M rows, 87MB] [799K rows/s, 23.2MB/s]</div></pre></td></tr></table></figure></p>
<p>The query finished in 9 seconds with the CSV-formatted data and in 4 seconds with the Parquet-formatted data. I grepped the server log to see the time lines recorded by the Query Monitor.<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">$ grep 20160131_160009_00002_s4z65 ~/datap/var/<span class="built_in">log</span>/server.log</div><div class="line">...elapsed 3886.00ms :: planning 644.26ms :: scheduling 1099.00ms :: running 2094.00ms :: finishing 49.00ms...</div><div class="line"></div><div class="line">$ grep 20160131_160411_00005_s4z65 ~/datap/var/<span class="built_in">log</span>/server.log</div><div class="line">...elapsed 1406.00ms :: planning 91.68ms :: scheduling 55.00ms :: running 1221.00ms :: finishing 38.00ms...</div></pre></td></tr></table></figure></p>
<p>I’m not surprised that the columnar-based, Parquet-format-backed query was twice as fast but I’m not sure how the timings the Query Monitor recorded relate to the times reported by the CLI. It gives me something to dig into at a later point.</p>
<p>I took a look at the query plans to see if they offer anything of interest. In the case of these two queries they were identical bar the table names.<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">EXPLAIN</span></div><div class="line"><span class="keyword">SELECT</span> <span class="keyword">year</span>, <span class="keyword">count</span>(*)</div><div class="line"><span class="keyword">FROM</span> track_metadata_csv</div><div class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> <span class="keyword">year</span></div><div class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">year</span>;</div><div class="line">                                                                  </div><div class="line"><span class="comment">----------------------------------------------------------------------------------------------------------------------------------------------</span></div><div class="line"> - Output[year, _col1] =&gt; [year:bigint, count:bigint]</div><div class="line">         _col1 := count</div><div class="line">     - Sort[year ASC_NULLS_LAST] =&gt; [year:bigint, count:bigint]</div><div class="line">         - Exchange[GATHER] =&gt; year:bigint, count:bigint</div><div class="line">             - Aggregate(FINAL)[year] =&gt; [year:bigint, count:bigint]</div><div class="line">                     count := "count"("count_9")</div><div class="line">                 - Exchange[REPARTITION] =&gt; year:bigint, count_9:bigint</div><div class="line">                     - Aggregate(PARTIAL)[year] =&gt; [year:bigint, count_9:bigint]</div><div class="line">                             count_9 := "count"(*)</div><div class="line">                         - TableScan[hive:hive:default:track_metadata_csv, originalConstraint = true] =&gt; [year:bigint]</div><div class="line">                                 LAYOUT: hive</div><div class="line">                                 year := HiveColumnHandle&#123;clientId=hive, name=year, hiveType=smallint, hiveColumnIndex=5, partitionKey=false&#125;</div><div class="line"><span class="keyword">EXPLAIN</span></div><div class="line"><span class="keyword">SELECT</span> <span class="keyword">year</span>, <span class="keyword">count</span>(*)</div><div class="line"><span class="keyword">FROM</span> track_metadata_parquet</div><div class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> <span class="keyword">year</span></div><div class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">year</span>;</div><div class="line">                                                                  Query Plan</div><div class="line"><span class="comment">----------------------------------------------------------------------------------------------------------------------------------------------</span></div><div class="line"> - Output[year, _col1] =&gt; [year:bigint, count:bigint]</div><div class="line">         _col1 := count</div><div class="line">     - Sort[year ASC_NULLS_LAST] =&gt; [year:bigint, count:bigint]</div><div class="line">         - Exchange[GATHER] =&gt; year:bigint, count:bigint</div><div class="line">             - Aggregate(FINAL)[year] =&gt; [year:bigint, count:bigint]</div><div class="line">                     count := "count"("count_9")</div><div class="line">                 - Exchange[REPARTITION] =&gt; year:bigint, count_9:bigint</div><div class="line">                     - Aggregate(PARTIAL)[year] =&gt; [year:bigint, count_9:bigint]</div><div class="line">                             count_9 := "count"(*)</div><div class="line">                         - TableScan[hive:hive:default:track_metadata_parquet, originalConstraint = true] =&gt; [year:bigint]</div><div class="line">                                 LAYOUT: hive</div><div class="line">                                 year := HiveColumnHandle&#123;clientId=hive, name=year, hiveType=smallint, hiveColumnIndex=5, partitionKey=false&#125;</div></pre></td></tr></table></figure></p>
<h2 id="Airpal_3A_A_Web_Interface_for_Presto"><a href="#Airpal_3A_A_Web_Interface_for_Presto" class="headerlink" title="Airpal: A Web Interface for Presto"></a>Airpal: A Web Interface for Presto</h2><p>In March 2015 AirBNB announced Airpal, a web-based query tool that works with Presto. Beyond a visual interface to run queries it offers access controls, metadata exploration, query progress tracking and CSV exporting of results.</p>
<p>These are the steps I took to install this software and launch it within the same Docker container as Presto.</p>
<p>The first thing I had to do was to get a copy of Airpal’s git repository and build the Airpal JAR file.<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">$ apt-get install \</div><div class="line">    build-essential \</div><div class="line">    git \</div><div class="line">    gradle \</div><div class="line">    mysql-server</div><div class="line">$ git <span class="built_in">clone</span> https://github.com/airbnb/airpal.git</div><div class="line">$ <span class="built_in">cd</span> airpal</div><div class="line">$ ./gradlew clean shadowJar</div></pre></td></tr></table></figure></p>
<p>I then created a MySQL database for Airpal to store it’s configuration and logs.<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$ mysql \</div><div class="line">    -uroot \</div><div class="line">    -proot \</div><div class="line">    -e<span class="string">'CREATE DATABASE `airpal` CHARACTER SET utf8 COLLATE utf8_general_ci;'</span></div></pre></td></tr></table></figure></p>
<p>Airpal needs a configuration file to tell it’s JAR file how to, among other things, connect with the MySQL data backend.<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ vi reference.yml</div></pre></td></tr></table></figure></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"># Logging settings</div><div class="line">logging:</div><div class="line"></div><div class="line">  loggers:</div><div class="line">    org.apache.shiro: INFO</div><div class="line"></div><div class="line">  # The default level of all loggers. Can be OFF, ERROR, WARN, INFO, DEBUG, TRACE, or ALL.</div><div class="line">  level: INFO</div><div class="line"></div><div class="line"># HTTP-specific options.</div><div class="line">server:</div><div class="line">  applicationConnectors:</div><div class="line">    - type: http</div><div class="line">      port: 8081</div><div class="line">      idleTimeout: 10 seconds</div><div class="line"></div><div class="line">  adminConnectors:</div><div class="line">    - type: http</div><div class="line">      port: 8082</div><div class="line"></div><div class="line">shiro:</div><div class="line">  iniConfigs: ["classpath:shiro_allow_all.ini"]</div><div class="line"></div><div class="line">dataSourceFactory:</div><div class="line">  driverClass: com.mysql.jdbc.Driver</div><div class="line">  user: root</div><div class="line">  password: root</div><div class="line">  url: jdbc:mysql://127.0.0.1:3306/airpal</div><div class="line"></div><div class="line"># The URL to the Presto coordinator.</div><div class="line">prestoCoordinator: http://127.0.0.1:8080</div></pre></td></tr></table></figure>
<p>With that in place I setup Airpal’s database schema and launched the server in the background.<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">$ java -Duser.timezone=UTC \</div><div class="line">       -cp build/libs/airpal-*-all.jar \</div><div class="line">       com.airbnb.airpal.AirpalApplication \</div><div class="line">       db migrate reference.yml</div><div class="line">$ java -server \</div><div class="line">       -Duser.timezone=UTC \</div><div class="line">       -cp build/libs/airpal-*-all.jar \</div><div class="line">       com.airbnb.airpal.AirpalApplication \</div><div class="line">       server reference.yml &amp;</div></pre></td></tr></table></figure></p>
<p>Their is a health check endpoint on port 8082.<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">$ curl -s http://127.0.0.1:8082/healthcheck | \</div><div class="line">    python -m json.tool</div><div class="line">&#123;</div><div class="line">    <span class="string">"deadlocks"</span>: &#123;</div><div class="line">        <span class="string">"healthy"</span>: <span class="literal">true</span></div><div class="line">    &#125;,</div><div class="line">    <span class="string">"mysql"</span>: &#123;</div><div class="line">        <span class="string">"healthy"</span>: <span class="literal">true</span></div><div class="line">    &#125;,</div><div class="line">    <span class="string">"presto"</span>: &#123;</div><div class="line">        <span class="string">"healthy"</span>: <span class="literal">true</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>If that all looks well the web interface is configured to be exposed on port 8081.<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ curl http://127.0.0.1:8081/app</div></pre></td></tr></table></figure></p>
<p>Thank you for taking the time to read this post. If you’re considering using Digital Ocean, the hosting provider this blog is hosted on, please consider using this link to sign up.<br>转 <a href="http://tech.marksblogg.com/presto-parquet-airpal.html" target="_blank" rel="external">http://tech.marksblogg.com/presto-parquet-airpal.html</a></p>

            </div>
        
        <footer class="article-footer">
        </footer>
    </div>
</article>


    
<nav id="article-nav">
    
        <a href="/2016/02/19/service-discovery-consul-and-consul-template/" id="article-nav-newer" class="article-nav-link-wrap">
            <strong class="article-nav-caption">Newer</strong>
            <div class="article-nav-title">
                
                    Service discovery with consul and consul-template
                
            </div>
        </a>
    
    
        <a href="/2016/01/27/spark-sort-shuffle-analyse/" id="article-nav-older" class="article-nav-link-wrap">
            <strong class="article-nav-caption">Older</strong>
            <div class="article-nav-title">Spark Sort Based Shuffle内存分析</div>
        </a>
    
</nav>





    
    
        <section id="comments"> 
    <div class="ds-thread" data-thread-key="2016/02/04/presto-parquet-airpal/" data-title="Presto, Parquet &amp; Airpal" data-url="https://blog.djstudy.net/2016/02/04/presto-parquet-airpal/"></div>
    <style>
        #ds-thread #ds-reset .ds-textarea-wrapper {
            background: none;
        }
        #ds-reset .ds-avatar img {
            box-shadow: none;
        }
        #ds-reset .ds-gradient-bg {
            background: #f7f7f7;
        }
        #ds-thread #ds-reset li.ds-tab a {
            border-radius: 3px;
        }
        #ds-thread #ds-reset .ds-post-button {
            color: white;
            border: none;
            box-shadow: none;
            background: #d32;
            text-shadow: none;
            font-weight: normal;
            font-family: 'Microsoft Yahei';
        }
        #ds-thread #ds-reset .ds-post-button:hover {
            color: white;
            background: #DE594C;
        }
        #ds-thread #ds-reset .ds-post-button:active {
            background: #d32;
        }
        #ds-smilies-tooltip ul.ds-smilies-tabs li a.ds-current {
            color: white;
            background: #d32;
            box-shadow: none;
            text-shadow: none;
            font-weight: normal;
        }
    </style>
 </section>
    




<!-- baidu url auto push script -->
<script type="text/javascript">
    !function(){var e=/([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi,r=window.location.href,o=document.referrer;if(!e.test(r)){var n="//api.share.baidu.com/s.gif";o?(n+="?r="+encodeURIComponent(document.referrer),r&&(n+="&l="+r)):r&&(n+="?l="+r);var t=new Image;t.src=n}}(window);
</script>     
</section>
        </div>
        <footer id="footer">
    <div class="outer">
        <div id="footer-info" class="inner">
            东杰 &copy; 2018 
            <a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-nd/4.0/80x15.png" /></a>
            <br> Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>. Theme - <a href="https://github.com/zthxxx/hexo-theme-Wikitten">wikitten</a>
            
                <br>
                <span id="busuanzi_container_site_pv"><i class="fa fa-eye"></i> <span id="busuanzi_value_site_pv"></span></span>
                &nbsp;|&nbsp;
                <span id="busuanzi_container_site_pv"><i class="fa fa-user"></i> <span id="busuanzi_value_site_uv"></span></span>
            
        </div>
    </div>
</footer>

        
    
    <script type="text/javascript">
    var duoshuoQuery = {short_name:'hivefans'};
    (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0]
    || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
    </script>



    
        <script src="/libs/lightgallery/js/lightgallery.min.js"></script>
        <script src="/libs/lightgallery/js/lg-thumbnail.min.js"></script>
        <script src="/libs/lightgallery/js/lg-pager.min.js"></script>
        <script src="/libs/lightgallery/js/lg-autoplay.min.js"></script>
        <script src="/libs/lightgallery/js/lg-fullscreen.min.js"></script>
        <script src="/libs/lightgallery/js/lg-zoom.min.js"></script>
        <script src="/libs/lightgallery/js/lg-hash.min.js"></script>
        <script src="/libs/lightgallery/js/lg-share.min.js"></script>
        <script src="/libs/lightgallery/js/lg-video.min.js"></script>
    
    
        <script src="/libs/justified-gallery/jquery.justifiedGallery.min.js"></script>
    
    
        <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true,
            TeX: {
                equationNumbers: {
                  autoNumber: 'AMS'
                }
            }
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script async src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    



<!-- Custom Scripts -->
<script src="/js/main.js"></script>

    </div>
</body>
</html>